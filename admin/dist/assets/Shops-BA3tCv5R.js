import{u as q,r as d,e as I,d as _,R as D,j as e}from"./index-BouADcV8.js";import{u as w}from"./index-DS6Sn0NB.js";import{u as N}from"./useMutation-Vq-BzWq0.js";import{c as L,u as $,d as K,g as Q}from"./shopService-CWGVHyjB.js";import{g as A}from"./userService-CG63Svn2.js";import{S as C,g as R}from"./ShopFormModal-ny_18lEM.js";import{C as V}from"./ConfirmDialog-kzTFUtgg.js";import"./api-DwbFXHRK.js";import"./index.esm-A7arJavU.js";import"./ImagePreviewModal-jtcB2eMQ.js";function Y(){const{t}=q(),[a,c]=d.useState(1),[h,M]=d.useState(5),[j,k]=d.useState(""),[P,m]=d.useState(!1),[o,u]=d.useState(null),[p,y]=d.useState(null),b=I(),E=_(),{data:n,isLoading:F,error:S}=w({queryKey:["shops",a,h,j],queryFn:()=>Q(a,h,j)}),{data:f}=w({queryKey:["users",1,1e3,""],queryFn:()=>A(1,1e3,"")}),x=D.useMemo(()=>{const s={};return f?.data?.forEach(l=>{s[l._id]=l}),s},[f]),r=N({mutationFn:async s=>L(s),onSuccess:()=>{m(!1),b.invalidateQueries({queryKey:["shops"]})}}),i=N({mutationFn:async s=>$(s),onSuccess:()=>{m(!1),u(null),b.invalidateQueries({queryKey:["shops"]})}}),v=N({mutationFn:async s=>{if(!s||!s._id)throw new Error("Invalid shop");return K(s._id)},onSuccess:()=>{y(null),b.invalidateQueries({queryKey:["shops"]})}});return e.jsxs("div",{className:"p-8 min-h-screen bg-[#1a2236] text-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:t("shops.title")}),e.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold",onClick:()=>{u(null),m(!0)},children:t("shops.addShop")})]}),e.jsxs("div",{className:"mb-4 flex items-center",children:[e.jsx("input",{className:"bg-[#232b42] text-white px-4 py-2 rounded-lg w-80 focus:outline-none focus:ring",placeholder:t("shops.searchShop","Search Shop"),value:j,onChange:s=>k(s.target.value)}),e.jsxs("span",{className:"ml-4 text-gray-400",children:[t("navigation.dashboard")," â€¢ ",e.jsx("span",{className:"bg-blue-900 text-blue-300 px-2 py-1 rounded text-xs ml-2",children:t("shops.title")})]})]}),e.jsx("div",{className:"bg-[#232b42] rounded-xl overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-[#2e3650]",children:[e.jsx("th",{className:"py-3 px-4",children:"#"}),e.jsx("th",{className:"py-3 px-4",children:t("shops.shopLogo","Logo")}),e.jsx("th",{className:"py-3 px-4",children:t("common.name")}),e.jsx("th",{className:"py-3 px-4",children:t("shops.owner")}),e.jsx("th",{className:"py-3 px-4",children:t("common.phone")}),e.jsx("th",{className:"py-3 px-4",children:t("users.city")}),e.jsx("th",{className:"py-3 px-4",children:t("common.status")}),e.jsx("th",{className:"py-3 px-4",children:t("common.actions")})]})}),e.jsx("tbody",{children:F?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center py-8",children:t("common.loading")})}):S?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center py-8 text-red-400",children:String(S.message)})}):n?.data?.length?n.data.map((s,l)=>e.jsxs("tr",{className:"border-b border-[#2e3650] hover:bg-[#202840] transition cursor-pointer",onClick:()=>E(`/shops/${s._id}`),title:t("shops.viewShopDetails","View shop details"),children:[e.jsx("td",{className:"py-3 px-4",children:(a-1)*h+l+1}),e.jsx("td",{className:"py-3 px-4",children:s.logo?e.jsx("img",{src:s.logo,alt:`${s.name} logo`,className:"w-8 h-8 object-cover rounded"}):e.jsx("div",{className:"w-8 h-8 bg-gray-600 rounded flex items-center justify-center text-xs text-gray-400",children:s.name.charAt(0).toUpperCase()})}),e.jsx("td",{className:"py-3 px-4 font-semibold",children:s.name}),e.jsx("td",{className:"py-3 px-4",children:x[s.ownerId]&&(`${x[s.ownerId].firstName||""} ${x[s.ownerId].lastName||""}`.trim()||x[s.ownerId].username)||s.ownerId}),e.jsx("td",{className:"py-3 px-4",children:s.contactInfo?.phoneNumber}),e.jsx("td",{className:"py-3 px-4",children:s.address?.city}),e.jsx("td",{className:"py-3 px-4 capitalize",children:t(`common.${s.status}`)}),e.jsxs("td",{className:"py-3 px-4 flex gap-3",onClick:g=>g.stopPropagation(),children:[e.jsx("button",{onClick:()=>{u(s),m(!0)},className:"hover:text-blue-400",title:t("common.edit"),children:e.jsx("svg",{width:"18",height:"18",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M15.232 5.232l3.536 3.536M9 13l6.586-6.586a2 2 0 112.828 2.828L11.828 15.828a2 2 0 01-1.414.586H7v-3a2 2 0 01.586-1.414z"})})}),e.jsx("button",{onClick:()=>y(s),className:"hover:text-red-400",title:t("common.delete"),children:e.jsx("svg",{width:"18",height:"18",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M1 7h22M8 7V5a2 2 0 012-2h4a2 2 0 012 2v2"})})})]})]},s._id)):e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center py-8",children:t("shops.noShopsFound","No shops found.")})})})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:[t("users.itemsPerPage"),":"]}),e.jsx("select",{className:"bg-[#232b42] text-white px-2 py-1 rounded",value:h,onChange:s=>{M(Number(s.target.value)),c(1)},children:[5,10,20,50].map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("button",{className:"px-2 py-1 mx-1 rounded disabled:opacity-50",onClick:()=>c(1),disabled:a===1,children:"<<"}),e.jsx("button",{className:"px-2 py-1 mx-1 rounded disabled:opacity-50",onClick:()=>c(s=>Math.max(1,s-1)),disabled:a===1,children:"<"}),e.jsxs("span",{className:"mx-2",children:[a," / ",n?.meta?.totalPages??1]}),e.jsx("button",{className:"px-2 py-1 mx-1 rounded disabled:opacity-50",onClick:()=>c(s=>Math.min(n?.meta?.totalPages??1,s+1)),disabled:a===(n?.meta?.totalPages??1),children:">"}),e.jsx("button",{className:"px-2 py-1 mx-1 rounded disabled:opacity-50",onClick:()=>c(n?.meta?.totalPages??1),disabled:a===(n?.meta?.totalPages??1),children:">>"})]})]}),e.jsx(C,{open:P&&!o,mode:"add",loading:r.status==="pending",error:r.isError?r.error?.message:null,details:r.isError?r.error?.details:null,onClose:()=>m(!1),onSubmit:s=>r.mutate(s)}),e.jsx(C,{open:!!o,mode:"edit",initialValues:o||void 0,loading:i.status==="pending",error:i.isError?i.error?.message:null,details:i.isError?i.error?.details:null,onClose:()=>u(null),onSubmit:s=>{if(o){const l=R(o,s),g={...l,_id:o._id};console.log("Shop edit - Original:",o),console.log("Shop edit - Changes:",l),console.log("Shop edit - Sending:",g),i.mutate(g)}}}),e.jsx(V,{open:!!p,title:t("shops.deleteShop"),description:p?t("modals.confirmDeleteShop","Are you sure you want to delete {{shopName}}?",{shopName:p.name}):"",loading:v.status==="pending",onCancel:()=>y(null),onConfirm:()=>{p&&v.mutate(p)}})]})}export{Y as default};
