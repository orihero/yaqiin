import{u as A,R as F,j as e,I as N,r as C,e as O}from"./index-BouADcV8.js";import{u as I}from"./index-DS6Sn0NB.js";import{u as S}from"./useMutation-Vq-BzWq0.js";import{S as $,c as B,u as T,d as H,b as W,a as G,e as J}from"./SequentialCategorySelect-BfnC-XWS.js";import{u as X}from"./index.esm-A7arJavU.js";import{C as L}from"./ConfirmDialog-kzTFUtgg.js";import"./api-DwbFXHRK.js";function Y(n){return n?typeof n=="string"?e.jsx("div",{className:"text-red-400 text-xs",children:n}):n.errors?e.jsx("ul",{className:"text-red-400 text-xs mb-2",children:Object.entries(n.errors).map(([a,u])=>e.jsxs("li",{children:[a,": ",u.message]},a))}):n.message?e.jsx("div",{className:"text-red-400 text-xs mb-2",children:n.message}):null:null}function R({open:n,mode:a,loading:u,error:p,details:d,initialValues:s,onClose:l,onSubmit:x}){const{t:i}=A(),o=a==="edit",{register:h,handleSubmit:k,reset:y,formState:{errors:t},watch:c,setValue:j}=X({defaultValues:{name:{uz:s?.name?.uz||"",ru:s?.name?.ru||""},description:{uz:s?.description?.uz||"",ru:s?.description?.ru||""},isActive:s?.isActive??!0,icon:s?.icon||"",parentId:s?.parentId||""}});return F.useEffect(()=>{n&&y({name:{uz:s?.name?.uz||"",ru:s?.name?.ru||""},description:{uz:s?.description?.uz||"",ru:s?.description?.ru||""},isActive:s?.isActive??!0,icon:s?.icon||"",parentId:s?.parentId||""})},[n,s,y]),n?e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm transition-all",style:{backdropFilter:"blur(8px)"},onClick:l}),e.jsxs("div",{className:"fixed top-0 right-0 h-full w-full max-w-xl bg-[#232b42] shadow-2xl p-8 overflow-y-auto transition-transform duration-300 transform translate-x-0",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:i(o?"categories.editCategory":"categories.addCategory")}),p&&e.jsx("div",{className:"text-red-400 mb-2",children:p}),Y(d),e.jsxs("form",{onSubmit:k(g=>{const f={...g,parentId:g.parentId||null};x(f)}),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:i("categories.nameUzbek","Name (Uzbek)")}),e.jsx("input",{className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white",...h("name.uz",{required:i("categories.nameUzbekRequired","Name (Uzbek) is required")})}),t?.name?.uz&&e.jsx("span",{className:"text-red-400 text-xs",children:t.name.uz.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:i("categories.nameRussian","Name (Russian)")}),e.jsx("input",{className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white",...h("name.ru",{required:i("categories.nameRussianRequired","Name (Russian) is required")})}),t?.name?.ru&&e.jsx("span",{className:"text-red-400 text-xs",children:t.name.ru.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:i("categories.descriptionUzbek","Description (Uzbek)")}),e.jsx("textarea",{className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white",...h("description.uz")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:i("categories.descriptionRussian","Description (Russian)")}),e.jsx("textarea",{className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white",...h("description.ru")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:i("categories.iconName","Icon (Iconify name)")}),e.jsx("input",{className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white",...h("icon"),placeholder:i("categories.iconPlaceholder","e.g. mdi:food-apple")}),typeof c=="function"&&c("icon")&&e.jsx("div",{className:"mt-2",children:e.jsx(N,{icon:c("icon"),width:32,height:32})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block mb-1",children:i("categories.parentCategory","Parent Category")}),e.jsx($,{value:c("parentId")||"",onChange:g=>j("parentId",g),placeholder:i("categories.selectParentCategory","Select parent category"),className:"w-full",open:n,excludeId:o?s?._id:void 0}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:i("categories.parentCategoryHelp","Leave empty to create a root category")})]}),e.jsxs("div",{className:"col-span-2 flex items-center gap-2 mt-2",children:[e.jsx("input",{type:"checkbox",id:"isActive",...h("isActive"),className:"w-4 h-4"}),e.jsx("label",{htmlFor:"isActive",className:"text-white",children:i("common.active")})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx("button",{type:"button",className:"px-4 py-2 rounded bg-gray-600 hover:bg-gray-700",onClick:l,children:i("common.cancel")}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-blue-500 hover:bg-blue-600",disabled:u,children:i(u?o?"common.saving":"common.creating":"common.save")})]})]})]})]}):null}const Z=n=>{const a=new Map,u=[];n.forEach(s=>{a.set(s._id,{...s,children:[]})}),n.forEach(s=>{const l=a.get(s._id);s.parentId&&a.has(s.parentId)?a.get(s.parentId).children.push(l):u.push(l)});const p=s=>s.sort((l,x)=>l.sortOrder!==void 0&&x.sortOrder!==void 0?l.sortOrder-x.sortOrder:l.name.uz.localeCompare(x.name.uz)),d=s=>{p(s),s.forEach(l=>{l.children.length>0&&d(l.children)})};return d(u),u},M=({categories:n,selectedCategories:a,onSelectCategory:u,onEditCategory:p,onDeleteCategory:d,productCounts:s={},level:l=0})=>{const[x,i]=C.useState(new Set),{t:o}=A(),h=t=>{const c=new Set(x);c.has(t)?c.delete(t):c.add(t),i(c)},k=t=>{let c=s[t._id]||0;const j=g=>{g.forEach(f=>{c+=s[f._id]||0,f.children.length>0&&j(f.children)})};return j(t.children),c},y=(t,c)=>{const j=x.has(t._id),g=t.children.length>0,f=a.has(t._id),w=l*20,b=s[t._id]||0,v=k(t);return e.jsxs("div",{className:"border-b border-[#2e3650] last:border-b-0",children:[e.jsxs("div",{className:`flex items-center py-3 px-4 hover:bg-[#202840] transition ${f?"bg-blue-900 bg-opacity-30":""}`,style:{paddingLeft:`${16+w}px`},children:[e.jsx("div",{className:"flex items-center mr-3 flex-shrink-0",children:e.jsx("input",{type:"checkbox",checked:f,onChange:()=>u(t._id),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"})}),e.jsx("div",{className:"flex items-center mr-3 flex-shrink-0",children:g?e.jsx("button",{onClick:()=>h(t._id),className:"text-gray-400 hover:text-white transition",children:e.jsx(N,{icon:j?"mdi:chevron-down":"mdi:chevron-right",width:20,height:20})}):e.jsx("div",{className:"w-5"})}),e.jsx("div",{className:"flex items-center mr-3 flex-shrink-0",children:t.icon?e.jsx(N,{icon:t.icon,width:20,height:20,className:"text-blue-400"}):e.jsx(N,{icon:"mdi:folder",width:20,height:20,className:"text-gray-400"})}),e.jsx("div",{className:"flex-1 min-w-0 overflow-hidden",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-white truncate",children:t.name.uz}),t.description?.uz&&e.jsx("p",{className:"text-sm text-gray-400 truncate",children:t.description.uz})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium whitespace-nowrap ${t.isActive?"bg-green-900 text-green-300":"bg-red-900 text-red-300"}`,children:t.isActive?o("common.active"):o("common.inactive")}),b>0&&e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-blue-900 text-blue-300 whitespace-nowrap",children:b}),v>b&&e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-purple-900 text-purple-300 whitespace-nowrap",children:v}),g&&e.jsx("span",{className:"text-xs text-gray-400 whitespace-nowrap hidden lg:inline",children:t.children.length})]})]})}),e.jsxs("div",{className:"flex items-center gap-1 ml-2 flex-shrink-0",children:[e.jsx("button",{onClick:()=>p(t),className:"p-1 hover:text-blue-400 transition",title:o("common.edit"),children:e.jsx(N,{icon:"mdi:pencil",width:16,height:16})}),e.jsx("button",{onClick:()=>d(t),className:"p-1 hover:text-red-400 transition",title:o("common.delete"),children:e.jsx(N,{icon:"mdi:delete",width:16,height:16})})]})]}),g&&j&&e.jsx("div",{className:"bg-[#1a1f2e]",children:e.jsx(M,{categories:t.children,selectedCategories:a,onSelectCategory:u,onEditCategory:p,onDeleteCategory:d,productCounts:s,level:l+1})})]},t._id)};return e.jsx("div",{children:n.map((t,c)=>y(t))})};function ae(){const{t:n}=A(),[a,u]=C.useState(""),[p,d]=C.useState(!1),[s,l]=C.useState(null),[x,i]=C.useState(null),[o,h]=C.useState(new Set),[k,y]=C.useState(!1),t=O(),{data:c,isLoading:j,error:g}=I({queryKey:["categories-hierarchy",a],queryFn:()=>G()}),{data:f}=I({queryKey:["category-product-counts"],queryFn:()=>J()}),w=F.useMemo(()=>{if(!c)return[];let r=c;return a&&(r=c.filter(m=>m.name.uz.toLowerCase().includes(a.toLowerCase())||m.name.ru.toLowerCase().includes(a.toLowerCase())||m.description?.uz&&m.description.uz.toLowerCase().includes(a.toLowerCase())||m.description?.ru&&m.description.ru.toLowerCase().includes(a.toLowerCase()))),Z(r)},[c,a]),b=S({mutationFn:async r=>B(r),onSuccess:()=>{d(!1),t.invalidateQueries({queryKey:["categories-hierarchy"]})}}),v=S({mutationFn:async r=>T(r),onSuccess:()=>{d(!1),l(null),t.invalidateQueries({queryKey:["categories-hierarchy"]})}}),q=S({mutationFn:async r=>{if(!r||!r._id)throw new Error("Invalid category");return H(r._id)},onSuccess:()=>{i(null),t.invalidateQueries({queryKey:["categories-hierarchy"]})}}),z=S({mutationFn:async r=>W(r),onSuccess:()=>{h(new Set),y(!1),t.invalidateQueries({queryKey:["categories-hierarchy"]})}}),_=r=>{const m=[],D=U=>{U.forEach(E=>{m.push(E._id),E.children.length>0&&D(E.children)})};return D(r),m},P=()=>{const r=_(w);o.size===r.length?h(new Set):h(new Set(r))},K=r=>{const m=new Set(o);m.has(r)?m.delete(r):m.add(r),h(m)},Q=()=>{y(!0)};return e.jsxs("div",{className:"h-full flex flex-col bg-[#1a2236] text-white overflow-hidden",children:[e.jsxs("div",{className:"flex-shrink-0 p-6 pb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("h1",{className:"text-2xl font-bold",children:["ðŸ“‚ ",n("categories.title")]}),o.size>0&&e.jsxs("span",{className:"bg-blue-500 text-white px-3 py-1 rounded-full text-sm font-medium",children:[o.size," selected"]})]}),e.jsxs("div",{className:"flex gap-3",children:[o.size>0&&e.jsxs("button",{className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-semibold text-sm",onClick:Q,disabled:z.isPending,children:[e.jsx(N,{icon:"mdi:delete-sweep",className:"inline-block mr-1"}),"ðŸ—‘ï¸ Delete (",o.size,")"]}),e.jsxs("button",{className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold text-sm",onClick:()=>{l(null),d(!0)},children:[e.jsx(N,{icon:"mdi:plus",className:"inline-block mr-1"})," âž• ",n("categories.addCategory")]})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{className:"bg-[#232b42] text-white px-4 py-2 rounded-lg w-80 focus:outline-none focus:ring",placeholder:n("categories.searchCategory","Search Category"),value:a,onChange:r=>u(r.target.value)}),e.jsxs("span",{className:"ml-4 text-gray-400 text-sm",children:[n("navigation.dashboard")," â€¢ ",e.jsx("span",{className:"bg-blue-900 text-blue-300 px-2 py-1 rounded text-xs ml-2",children:n("categories.title")})]})]})]}),e.jsx("div",{className:"flex-1 flex flex-col min-h-0 px-6 pb-6",style:{maxWidth:"calc(100vw - 300px)"},children:e.jsxs("div",{className:"bg-[#232b42] rounded-xl overflow-hidden flex flex-col h-full",children:[e.jsx("div",{className:"flex-shrink-0 border-b border-[#2e3650] px-4 py-3 bg-[#1a2236]",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:w.length>0&&o.size===_(w).length,onChange:P,className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"ml-3 text-sm font-medium text-gray-300",children:n("common.selectAll","Select All")})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-auto",children:j?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"text-2xl mb-4",children:"â³"}),e.jsx("div",{className:"text-lg font-medium text-gray-300",children:n("common.loading")})]}):g?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"text-2xl mb-4 text-red-400",children:"âŒ"}),e.jsx("div",{className:"text-lg font-medium text-red-400",children:String(g.message)})]}):w.length?e.jsx(M,{categories:w,selectedCategories:o,onSelectCategory:K,onEditCategory:r=>{l(r),d(!0)},onDeleteCategory:i,productCounts:f}):e.jsx("div",{className:"text-center py-16 text-gray-400",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(N,{icon:"mdi:folder-outline",className:"text-5xl mb-4"}),e.jsxs("div",{className:"text-lg font-medium",children:["ðŸ“­ ",n("categories.noCategoriesFound","No categories found.")]}),e.jsx("div",{className:"text-sm",children:'Click "Add Category" to create your first category'})]})})})]})}),e.jsx(R,{open:p&&!s,mode:"add",loading:b.status==="pending",error:b.isError?b.error?.message:null,details:b.isError?b.error?.details:null,onClose:()=>d(!1),onSubmit:r=>b.mutate(r)}),e.jsx(R,{open:p&&!!s,mode:"edit",loading:v.status==="pending",error:v.isError?v.error?.message:null,details:v.isError?v.error?.details:null,initialValues:s,onClose:()=>{d(!1),l(null)},onSubmit:r=>v.mutate({...r,_id:s?._id})}),e.jsx(L,{open:!!x,title:n("categories.deleteCategory"),description:n("categories.confirmDeleteCategory","Are you sure you want to delete this category? This action cannot be undone."),loading:q.status==="pending",onCancel:()=>i(null),onConfirm:()=>x&&q.mutate(x)}),e.jsx(L,{open:k,title:"ðŸ—‘ï¸ Bulk Delete Categories",description:`âš ï¸ Are you sure you want to delete ${o.size} selected categories? This action cannot be undone.`,loading:z.isPending,onCancel:()=>y(!1),onConfirm:()=>z.mutate(Array.from(o))})]})}export{ae as default};
