import{r as g,j as e,u as A,e as q}from"./index-BouADcV8.js";import{u as E}from"./index-DS6Sn0NB.js";import{u as w}from"./useMutation-Vq-BzWq0.js";import{a as v}from"./api-DwbFXHRK.js";import{C as M}from"./ConfirmDialog-kzTFUtgg.js";const P=async(t=1,r=10,m="")=>{const{data:u}=await v.get("/settings",{params:{page:t,limit:r,search:m}});return u},B=async t=>{const{data:r}=await v.post("/settings",t);return r},D=async t=>{const{_id:r,...m}=t,{data:u}=await v.put(`/settings/${r}`,m);return u},K=async t=>{const{data:r}=await v.delete(`/settings/${t}`);return r},Q=[{value:"bool",label:"Boolean"},{value:"text",label:"Text"},{value:"select",label:"Select"}],$=({open:t,onClose:r,onSubmit:m,loading:u,error:f,setting:l})=>{const[a,c]=g.useState({key:"",flagType:"bool",value:!1,options:"",description:"",isActive:!0});g.useEffect(()=>{c(l?{key:l.key||"",flagType:l.flagType||"bool",value:l.value??(l.flagType==="bool"?!1:""),options:Array.isArray(l.options)?l.options.join(", "):"",description:l.description||"",isActive:l.isActive??!0}:{key:"",flagType:"bool",value:!1,options:"",description:"",isActive:!0})},[l,t]);const i=n=>{const{name:d,value:p,type:j}=n.target;c(j==="checkbox"?b=>({...b,[d]:n.target.checked}):b=>({...b,[d]:p}))},y=n=>{const d=n.target.value;c(p=>({...p,flagType:d,value:d==="bool"?!1:"",options:""}))},h=n=>{n.preventDefault();const d={...a,options:a.flagType==="select"?a.options.split(",").map(p=>p.trim()).filter(Boolean):void 0,value:a.flagType==="bool"?!!a.value:a.value};m(d)};return t?e.jsxs("div",{className:"fixed inset-0 z-50 flex",children:[e.jsx("div",{className:"flex-1 backdrop-blur-sm bg-black/30",onClick:r}),e.jsxs("div",{className:"w-[400px] bg-[#232b42] p-8 h-full shadow-xl overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:l?"Edit Feature Flag":"Add Feature Flag"}),e.jsxs("form",{onSubmit:h,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Key"}),e.jsx("input",{name:"key",className:"w-full px-2 py-1 rounded bg-gray-800 border border-gray-600 text-white",value:a.key,onChange:i,required:!0,disabled:!!l})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Type"}),e.jsx("select",{name:"flagType",className:"w-full px-2 py-1 rounded bg-gray-800 border border-gray-600 text-white",value:a.flagType,onChange:y,required:!0,disabled:!!l,children:Q.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))})]}),a.flagType==="bool"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Value"}),e.jsx("input",{type:"checkbox",name:"value",checked:!!a.value,onChange:i})]}),a.flagType==="text"&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Value"}),e.jsx("input",{name:"value",className:"w-full px-2 py-1 rounded bg-gray-800 border border-gray-600 text-white",value:typeof a.value=="string"?a.value:"",onChange:i})]}),a.flagType==="select"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Options (comma separated)"}),e.jsx("input",{name:"options",className:"w-full px-2 py-1 rounded bg-gray-800 border border-gray-600 text-white",value:a.options,onChange:i,required:a.flagType==="select"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Value"}),e.jsx("select",{name:"value",className:"w-full px-2 py-1 rounded bg-gray-800 border border-gray-600 text-white",value:typeof a.value=="string"?a.value:"",onChange:i,children:a.options.split(",").map(n=>n.trim()).filter(Boolean).map(n=>e.jsx("option",{value:n,children:n},n))})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1 font-semibold",children:"Description"}),e.jsx("textarea",{name:"description",className:"w-full px-2 py-1 rounded bg-gray-800 border border-gray-600 text-white",value:a.description,onChange:i})]}),e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",name:"isActive",checked:!!a.isActive,onChange:i}),e.jsx("label",{className:"font-semibold",children:"Active"})]}),e.jsxs("div",{className:"mt-8 flex justify-end gap-2",children:[e.jsx("button",{className:"px-4 py-2 rounded bg-gray-600 hover:bg-gray-700",onClick:r,type:"button",disabled:u,children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 rounded bg-blue-500 hover:bg-blue-600 text-white",disabled:u,type:"submit",children:u?"Saving...":"Save"})]}),f&&e.jsx("div",{className:"text-red-400 mt-4",children:f})]})]})]}):null},_=({checked:t,onChange:r})=>e.jsx("button",{className:`w-12 h-7 flex items-center rounded-full p-1 transition-colors duration-200 border-none focus:outline-none ${t?"bg-green-500":"bg-gray-400"}`,onClick:()=>r(!t),type:"button","aria-pressed":t,style:{boxShadow:t?"0 0 0 2px #22c55e33":"0 0 0 1px #8884"},children:e.jsx("span",{className:`w-5 h-5 bg-white rounded-full shadow-lg transform transition-transform duration-200 ${t?"translate-x-5":""}`,style:{boxShadow:"0 2px 8px 0 #0002"}})}),R=()=>{const{t}=A(),r=[{key:"featureFlags",label:t("settings.featureFlags")}],[m,u]=g.useState("featureFlags"),[f,l]=g.useState(!1),[a,c]=g.useState(null),[i,y]=g.useState(null),h=q(),{data:n,isLoading:d,isError:p,error:j}=E({queryKey:["feature-flags"],queryFn:async()=>(await P(1,100)).data.filter(o=>o.flagType)}),b=w({mutationFn:s=>B(s),onSuccess:()=>{h.invalidateQueries({queryKey:["feature-flags"]}),l(!1)}}),x=w({mutationFn:s=>D(s),onSuccess:()=>{h.invalidateQueries({queryKey:["feature-flags"]}),c(null)}}),k=w({mutationFn:s=>K(s),onSuccess:()=>{h.invalidateQueries({queryKey:["feature-flags"]}),y(null)}}),N=(s,o)=>{x.mutate({...s,value:o})},T=()=>{c(null),l(!0)},C=s=>{c(s),l(!0)},F=s=>{y(s)},S=s=>{a?x.mutate({...a,...s}):b.mutate({...s,type:"system"})};return e.jsxs("div",{className:"p-8 min-h-screen bg-[#1a2236] text-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:t("navigation.settings")}),e.jsxs("button",{className:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold",onClick:T,children:["+ ",t("settings.addFeatureFlag")]})]}),e.jsx("div",{className:"flex gap-4 mb-8 border-b border-gray-700",children:r.map(s=>e.jsx("button",{className:`px-4 py-2 font-semibold border-b-2 transition-colors ${m===s.key?"border-blue-500 text-blue-400":"border-transparent text-gray-400 hover:text-white"}`,onClick:()=>u(s.key),children:s.label},s.key))}),m==="featureFlags"&&e.jsxs("div",{className:"bg-[#232b42] rounded-xl overflow-x-auto p-8 text-gray-200",children:[d&&e.jsx("div",{children:t("settings.loadingFeatureFlags")}),p&&e.jsxs("div",{className:"text-red-400",children:["Error: ",j?.message||t("settings.failedToLoadFeatureFlags")]}),!d&&!p&&e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-gray-400",children:[e.jsx("th",{className:"py-2 px-4",children:t("settings.key")}),e.jsx("th",{className:"py-2 px-4",children:t("settings.type")}),e.jsx("th",{className:"py-2 px-4",children:t("settings.value")}),e.jsx("th",{className:"py-2 px-4",children:t("settings.options")}),e.jsx("th",{className:"py-2 px-4",children:t("common.actions")})]})}),e.jsx("tbody",{children:n?.map(s=>e.jsxs("tr",{className:"border-b border-gray-700 last:border-b-0",children:[e.jsx("td",{className:"py-2 px-4 font-mono",children:s.key}),e.jsx("td",{className:"py-2 px-4 capitalize",children:s.flagType}),e.jsxs("td",{className:"py-2 px-4",children:[s.flagType==="bool"&&e.jsx(_,{checked:!!s.value,onChange:o=>N(s,o)}),s.flagType==="text"&&e.jsx("input",{className:"bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 w-64",type:"text",value:typeof s.value=="string"?s.value:"",onChange:o=>N(s,o.target.value),disabled:x.isPending}),s.flagType==="select"&&e.jsx("select",{className:"bg-gray-800 text-white px-2 py-1 rounded border border-gray-600 w-40",value:typeof s.value=="string"?s.value:"",onChange:o=>N(s,o.target.value),disabled:x.isPending,children:s.options?.map(o=>e.jsx("option",{value:o,children:o},o))})]}),e.jsx("td",{className:"py-2 px-4",children:s.flagType==="select"&&s.options?.join(", ")}),e.jsxs("td",{className:"py-2 px-4 flex gap-2",children:[e.jsxs("button",{className:"px-2 py-1 rounded bg-gray-700 hover:bg-gray-600 text-xs",onClick:()=>C(s),title:t("common.edit"),children:["✏️ ",t("common.edit")]}),e.jsxs("button",{className:"px-2 py-1 rounded bg-red-600 hover:bg-red-700 text-xs",onClick:()=>F(s),title:t("common.delete"),children:["🗑️ ",t("common.delete")]})]})]},s._id))})]})]}),e.jsx($,{open:f||!!a,onClose:()=>{l(!1),c(null)},onSubmit:S,loading:b.isPending||x.isPending,error:b.error?.message||x.error?.message||null,setting:a||void 0}),e.jsx(M,{open:!!i,title:t("settings.deleteFeatureFlag"),description:t("settings.deleteFeatureFlagConfirmation",{key:i?.key}),loading:k.isPending,onCancel:()=>y(null),onConfirm:()=>i&&k.mutate(i._id)})]})};export{R as default};
