import{u as U,r as o,j as r,I as $,R as q}from"./index-BouADcV8.js";import{u as T}from"./index-DS6Sn0NB.js";import{a as p}from"./api-DwbFXHRK.js";const D=async e=>{const t=await p.post("/categories",e);if(!t.data.success)throw new Error(t.data?.error?.message||"Failed to create category");return t.data.data},Q=async e=>{const{_id:t,...i}=e,d=await p.put(`/categories/${t}`,i);if(!d.data.success)throw new Error(d.data?.error?.message||"Failed to update category");return d.data.data},G=async e=>{const t=await p.delete(`/categories/${e}`);if(!t.data.success)throw new Error(t.data?.error?.message||"Failed to delete category");return t.data.data},J=async e=>{const t=await p.delete("/categories/bulk",{data:{categoryIds:e}});if(!t.data.success)throw new Error(t.data?.error?.message||"Failed to delete categories");return t.data.data},O=async()=>(await p.get("/categories?limit=1000")).data.data,W=async()=>(await p.get("/categories?limit=1000")).data.data,X=async()=>(await p.get("/categories/product-counts")).data.data,K=async e=>{const t=new URLSearchParams({limit:"1000",page:"1"});return e&&t.append("excludeId",e),(await p.get(`/categories?${t.toString()}`)).data.data.filter(h=>!h.parentId||h.parentId===null||h.parentId==="")},z=async(e,t)=>{if(!e)return K(t);const i=new URLSearchParams({parentId:e});return t&&i.append("excludeId",t),(await p.get(`/categories?${i.toString()}`)).data.data},A=async(e,t)=>{const i=new URLSearchParams({limit:"50",search:e});return t&&i.append("excludeId",t),(await p.get(`/categories?${i.toString()}`)).data.data.filter(g=>!g.parentId||g.parentId===null||g.parentId==="")},_=async(e,t,i)=>{if(!t)return A(e,i);const d=new URLSearchParams({limit:"50",search:e,parentId:t});return i&&d.append("excludeId",i),(await p.get(`/categories?${d.toString()}`)).data.data},I=({value:e,onChange:t,onSearch:i,placeholder:d,className:h="",disabled:g=!1,debounceMs:b=1e3,initialOptions:c=[]})=>{const{t:n}=U(),C=d||n("common.select"),[y,f]=o.useState(!1),[S,N]=o.useState(""),[m,l]=o.useState(c),[M,j]=o.useState(!1),[E,v]=o.useState(!1),P=o.useRef(null),R=o.useRef(),L=o.useCallback(a=>{R.current&&clearTimeout(R.current),R.current=setTimeout(async()=>{if(a.trim()){j(!0);try{const w=await i(a);l(w),v(!0)}catch(w){console.error("Search error:",w),l([])}finally{j(!1)}}else l(c),v(!1)},b)},[i,b,c]),k=a=>{const w=a.target.value;N(w),L(w)},F=()=>{g||(f(!0),!E&&c.length>0&&l(c))},s=()=>{f(!1),N(""),e||(l(c),v(!1))},u=a=>{t(a.value),f(!1),N(""),l([a]),v(!1)};o.useEffect(()=>{const a=w=>{P.current&&!P.current.contains(w.target)&&s()};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]),o.useEffect(()=>()=>{R.current&&clearTimeout(R.current)},[]),o.useEffect(()=>{if(e&&!m.find(a=>a.value===e)){const a=c.find(w=>w.value===e);a&&l([a])}},[e,m,c]);const x=m.find(a=>a.value===e);return r.jsxs("div",{className:`relative ${h}`,ref:P,children:[r.jsxs("button",{type:"button",onClick:F,className:"w-full bg-[#1a2236] text-white px-4 py-2 rounded-lg focus:outline-none focus:ring flex items-center justify-between",disabled:g,children:[r.jsx("span",{className:x?"text-white":"text-gray-400",children:x?x.label:C}),r.jsx($,{icon:y?"mdi:chevron-up":"mdi:chevron-down",className:"ml-2"})]}),y&&r.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-[#232b42] border border-[#2e3650] rounded-lg shadow-lg max-h-60 overflow-hidden",children:[r.jsx("div",{className:"p-2 border-b border-[#2e3650]",children:r.jsx("input",{type:"text",placeholder:n("common.search"),value:S,onChange:k,className:"w-full bg-[#1a2236] text-white px-3 py-2 rounded focus:outline-none focus:ring text-sm",autoFocus:!0})}),r.jsx("div",{className:"max-h-48 overflow-y-auto",children:M?r.jsx("div",{className:"px-4 py-3 text-center text-gray-400 text-sm",children:r.jsxs("div",{className:"flex items-center justify-center gap-2",children:[r.jsx($,{icon:"mdi:loading",className:"animate-spin",width:16,height:16}),n("common.searching","Searching...")]})}):m.length===0?r.jsx("div",{className:"px-4 py-2 text-gray-400 text-sm",children:E?n("common.noOptionsFound"):n("common.typeToSearch","Type to search...")}):m.map(a=>r.jsx("button",{type:"button",onClick:()=>u(a),className:`w-full text-left px-4 py-2 hover:bg-[#2e3650] transition-colors ${a.value===e?"bg-blue-600 text-white":"text-white"}`,children:a.label},a.value))})]})]})},Y=({value:e,onChange:t,placeholder:i,className:d="",disabled:h=!1,open:g=!0,excludeId:b})=>{const{t:c}=U(),[n,C]=o.useState(""),[y,f]=o.useState(""),[S,N]=o.useState(!1),[m,l]=o.useState(!1),{data:M=[]}=T({queryKey:["initial-main-categories",b],queryFn:()=>z(null,b),enabled:g}),{data:j=[]}=T({queryKey:["all-categories"],queryFn:O,enabled:g}),{data:E=[]}=T({queryKey:["subcategories",n],queryFn:()=>z(n),enabled:g&&!!n});o.useEffect(()=>{if(!S&&!m&&j.length>0){if(e&&e!==""){const s=j.find(u=>u._id===e);s&&s.parentId?(C(s.parentId),f(e)):(C(e),f(""))}else C(""),f("");N(!0)}},[e,j,S,m]),o.useEffect(()=>{},[e,S,n,y,m]);const v=s=>{l(!0),C(s),f(""),t(s),setTimeout(()=>l(!1),500)},P=s=>{l(!0),f(s),t(s),setTimeout(()=>l(!1),500)},R=async s=>{try{const u=await _(s,null,b),x=[];return b&&c("categories.noParent","No Parent (Root Category)").toLowerCase().includes(s.toLowerCase())&&x.push({value:"",label:c("categories.noParent","No Parent (Root Category)")}),x.push(...u.map(a=>({value:a._id,label:a.name.uz}))),x}catch(u){return console.error("Main category search error:",u),[]}},L=async s=>{try{return(await _(s,n)).map(x=>({value:x._id,label:x.name.uz}))}catch(u){return console.error("Subcategory search error:",u),[]}},k=q.useMemo(()=>{const s=[];return b&&s.push({value:"",label:c("categories.noParent","No Parent (Root Category)")}),s.push(...M.filter(u=>u._id!==b).map(u=>({value:u._id,label:u.name.uz}))),s},[M,b,c]),F=q.useMemo(()=>E.map(s=>({value:s._id,label:s.name.uz})),[E]);return o.useEffect(()=>{n&&f("")},[n]),o.useEffect(()=>{g||(N(!1),l(!1))},[g]),o.useEffect(()=>{S&&!m&&j.length>0&&(y||n)!==e&&N(!1)},[e,S,m,j,n,y]),r.jsxs("div",{className:`space-y-3 ${d}`,children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium mb-2 text-white",children:[c("categories.mainCategory","Main Category")," *"]}),r.jsx(I,{value:n,onChange:v,onSearch:R,initialOptions:k,placeholder:c("categories.selectMainCategory","Select main category"),className:"w-full",debounceMs:1e3,disabled:h})]}),n&&r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium mb-2 text-white",children:[c("categories.subCategory","Sub Category"),r.jsxs("span",{className:"text-gray-400 text-xs ml-1",children:["(",c("categories.optional","optional"),")"]})]}),r.jsx(I,{value:y,onChange:P,onSearch:L,initialOptions:F,placeholder:c("categories.selectSubCategory","Select subcategory (optional)"),className:"w-full",debounceMs:1e3,disabled:h}),!1]}),(n||y)&&r.jsx("div",{children:r.jsx("button",{type:"button",onClick:()=>{l(!0),C(""),f(""),t(""),setTimeout(()=>l(!1),500)},className:"text-sm text-gray-400 hover:text-white transition-colors",disabled:h,children:c("categories.clearSelection","Clear selection")})})]})};export{Y as S,W as a,J as b,D as c,G as d,X as e,O as g,Q as u};
