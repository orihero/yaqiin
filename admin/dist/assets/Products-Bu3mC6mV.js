import{r as m,j as e,u as X,e as Y,I as j}from"./index-BouADcV8.js";import{u as T}from"./index-DS6Sn0NB.js";import{S as Z,g as G}from"./SequentialCategorySelect-BfnC-XWS.js";import{M as Q,S as ee,g as se,f as te,a as ae}from"./units-B8aUyNEZ.js";import{I as $}from"./ImagePreviewModal-jtcB2eMQ.js";import{u as M}from"./useMutation-Vq-BzWq0.js";import{c as le,u as ie,d as ne,b as re,g as ce}from"./productService-Dhse-mQl.js";import{C as O}from"./ConfirmDialog-kzTFUtgg.js";import"./api-DwbFXHRK.js";const B={nameUz:"",nameRu:"",categoryId:"",basePrice:0,unit:"",unitMeasure:"",baseStockQuantity:0,isActive:!0,descUz:"",descRu:"",images:[],imagePreviews:[],imageUrls:[],formError:null};function de(l,a){switch(a.type){case"SET_FIELD":return{...l,[a.field]:a.value};case"SET_IMAGES":return{...l,images:a.files,imagePreviews:a.files.map(c=>URL.createObjectURL(c))};case"REMOVE_IMAGE":return{...l,images:l.images.filter((c,d)=>d!==a.index),imagePreviews:l.imagePreviews.filter((c,d)=>d!==a.index)};case"ADD_IMAGE_URL":return{...l,imageUrls:[...l.imageUrls,""]};case"SET_IMAGE_URL":return{...l,imageUrls:l.imageUrls.map((c,d)=>d===a.index?a.value:c)};case"REMOVE_IMAGE_URL":return{...l,imageUrls:l.imageUrls.filter((c,d)=>d!==a.index)};case"RESET_FORM":return B;case"LOAD_PRODUCT":return{...l,nameUz:a.product.name.uz||"",nameRu:a.product.name.ru||"",categoryId:a.product.categoryId||"",basePrice:a.product.basePrice||0,unit:a.product.unit||"",unitMeasure:a.product.unitMeasure||"",baseStockQuantity:a.product.baseStock?.quantity||0,isActive:a.product.isActive??!0,descUz:a.product.description?.uz||"",descRu:a.product.description?.ru||"",images:[],imagePreviews:Array.isArray(a.product.images)?a.product.images.filter(c=>typeof c=="string"):[],imageUrls:[],formError:null};default:return l}}function oe({open:l=!0,product:a,loading:c=!1,error:d,onClose:v,onSubmit:p}){const N=!!a,[i,n]=m.useReducer(de,B),[x,h]=m.useState(null),{data:b,isLoading:C}=T({queryKey:["categories"],queryFn:G});if(m.useEffect(()=>{a&&n({type:"LOAD_PRODUCT",product:a})},[a]),m.useEffect(()=>{!l&&!a&&n({type:"RESET_FORM"})},[l,a]),!l)return null;const u=t=>{t.preventDefault();const{nameUz:r,categoryId:k,basePrice:L,unit:f,baseStockQuantity:E,descUz:U,descRu:P}=i;if(!r||!k||!L||!f||!U||!P){n({type:"SET_FIELD",field:"formError",value:"Please fill in all required fields."});return}if(n({type:"SET_FIELD",field:"formError",value:null}),p){const _=i.imageUrls.map(z=>z.trim()).filter(Boolean);p({name:{uz:i.nameUz,ru:i.nameRu},description:{uz:i.descUz,ru:i.descRu},categoryId:i.categoryId,basePrice:i.basePrice,unit:i.unit,unitMeasure:i.unitMeasure||void 0,baseStock:i.baseStockQuantity?{quantity:i.baseStockQuantity,unit:i.unit}:void 0,isActive:i.isActive,images:i.images.length>0?i.images:void 0,imageUrls:_.length>0?_:void 0})}v()},y=t=>{if(t.target.files){const r=Array.from(t.target.files);n({type:"SET_IMAGES",files:r})}},A=t=>{n({type:"REMOVE_IMAGE",index:t})},w=()=>n({type:"ADD_IMAGE_URL"}),S=(t,r)=>{n({type:"SET_IMAGE_URL",index:t,value:r})},I=t=>{n({type:"REMOVE_IMAGE_URL",index:t})},g=(t,r=0)=>{h({images:t,initialIndex:r})};return e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm transition-all",style:{backdropFilter:"blur(8px)"},onClick:v}),e.jsxs("div",{className:"fixed top-0 right-0 h-full w-full max-w-xl bg-[#232b42] shadow-2xl p-8 overflow-y-auto transition-transform duration-300 transform translate-x-0",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-white",children:N?"✏️ Edit Product":"➕ Add Product"}),d&&e.jsxs("div",{className:"text-red-400 mb-2",children:["❌ ",d]}),i.formError&&e.jsxs("div",{className:"text-red-400 mb-2",children:["⚠️ ",i.formError]}),e.jsxs("form",{onSubmit:u,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-white",children:"📝 Name (Uzbek) *"}),e.jsx("input",{className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white",value:i.nameUz,onChange:t=>n({type:"SET_FIELD",field:"nameUz",value:t.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-white",children:"📝 Name (Russian) *"}),e.jsx("input",{className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white",value:i.nameRu,onChange:t=>n({type:"SET_FIELD",field:"nameRu",value:t.target.value}),required:!0})]}),e.jsx("div",{className:"col-span-2",children:e.jsx(Z,{value:i.categoryId,onChange:t=>n({type:"SET_FIELD",field:"categoryId",value:t}),placeholder:"Select category",className:"w-full",open:l})}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-white",children:"💰 Base Price *"}),e.jsx(Q,{type:"price",value:i.basePrice,onChange:t=>n({type:"SET_FIELD",field:"basePrice",value:t}),placeholder:"Enter price",className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-white",children:"📦 Unit *"}),e.jsx(ee,{value:i.unit,onChange:t=>n({type:"SET_FIELD",field:"unit",value:t}),options:se(),placeholder:"Select unit",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 text-white",children:"📏 Unit Measure"}),e.jsx("input",{className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white",value:i.unitMeasure,onChange:t=>n({type:"SET_FIELD",field:"unitMeasure",value:t.target.value}),placeholder:"e.g., 100mg, 1kg, 500ml"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-1 text-white",children:["📊 Base Stock Quantity",e.jsx("span",{className:"text-gray-400 text-xs ml-1",children:"(optional)"})]}),e.jsx(Q,{type:"number",value:i.baseStockQuantity,onChange:t=>n({type:"SET_FIELD",field:"baseStockQuantity",value:t}),placeholder:"Enter quantity (optional)",className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block mb-1 text-white",children:"📄 Description (Uzbek) *"}),e.jsx("textarea",{className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white",rows:2,value:i.descUz,onChange:t=>n({type:"SET_FIELD",field:"descUz",value:t.target.value}),required:!0})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block mb-1 text-white",children:"📄 Description (Russian) *"}),e.jsx("textarea",{className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white",rows:2,value:i.descRu,onChange:t=>n({type:"SET_FIELD",field:"descRu",value:t.target.value}),required:!0})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block mb-1 text-white",children:"🖼️ Product Images"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:y,className:"block mb-2"}),N&&a?.images&&a.images.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2 text-white text-sm",children:"📸 Current Product Images"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.images.map((t,r)=>e.jsx("div",{className:"relative w-20 h-20",children:e.jsx("img",{src:t,alt:`Product ${r+1}`,className:"w-full h-full object-cover rounded cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>g(a.images,r),title:"Click to preview"})},`existing-${r}`))})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:i.imagePreviews.map((t,r)=>e.jsxs("div",{className:"relative w-20 h-20",children:[e.jsx("img",{src:t,alt:"Preview",className:"w-full h-full object-cover rounded cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>g(i.imagePreviews,r),title:"Click to preview"}),e.jsx("button",{type:"button",className:"absolute top-0 right-0 bg-black/60 text-white rounded-full p-1 text-xs",onClick:()=>A(r),children:"❌"})]},r))}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block mb-1 text-white",children:"🔗 Or add image URLs"}),i.imageUrls.map((t,r)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{type:"text",className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white",placeholder:"https://...",value:t,onChange:k=>S(r,k.target.value)}),e.jsx("button",{type:"button",className:"text-red-400 hover:text-red-600",onClick:()=>I(r),children:"❌"})]},r)),e.jsx("button",{type:"button",className:"mt-2 px-3 py-1 rounded bg-blue-700 hover:bg-blue-800 text-white text-sm",onClick:w,children:"➕ Add Image URL"})]})]}),e.jsxs("div",{className:"col-span-2 flex items-center mt-2",children:[e.jsx("input",{type:"checkbox",id:"isActive",checked:i.isActive,onChange:t=>n({type:"SET_FIELD",field:"isActive",value:t.target.checked})}),e.jsx("label",{htmlFor:"isActive",className:"ml-2 text-white",children:"✅ Active"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx("button",{type:"button",className:"px-4 py-2 rounded bg-gray-600 hover:bg-gray-700",onClick:v,children:"❌ Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-blue-500 hover:bg-blue-600",disabled:c,children:c?N?"💾 Saving...":"🔄 Creating...":"💾 Save"})]})]})]}),e.jsx($,{open:!!x,images:x?.images||[],initialIndex:x?.initialIndex||0,onClose:()=>h(null)})]})}const je=()=>{const{t:l}=X(),[a,c]=m.useState(1),[d,v]=m.useState(10),[p,N]=m.useState(""),[i,n]=m.useState(!1),[x,h]=m.useState(null),[b,C]=m.useState(null),[u,y]=m.useState(new Set),[A,w]=m.useState(!1),[S,I]=m.useState(null),g=Y(),{data:t,isLoading:r,isError:k}=T({queryKey:["products",a,d,p],queryFn:()=>ce(a,d,p)}),{data:L}=T({queryKey:["categories"],queryFn:G}),f=M({mutationFn:async s=>le(s),onSuccess:()=>{n(!1),g.invalidateQueries({queryKey:["products"]})}}),E=M({mutationFn:async s=>ie(s),onSuccess:()=>{n(!1),h(null),g.invalidateQueries({queryKey:["products"]})}}),U=M({mutationFn:async s=>ne(s._id),onSuccess:()=>{C(null),g.invalidateQueries({queryKey:["products"]})}}),P=M({mutationFn:async s=>re(s),onSuccess:()=>{y(new Set),w(!1),g.invalidateQueries({queryKey:["products"]})}}),_=()=>{h(null),n(!0)},z=s=>{h(s),n(!0)},K=s=>{C(s)},V=()=>{t?.data&&(u.size===t.data.length?y(new Set):y(new Set(t.data.map(s=>s._id))))},W=s=>{const o=new Set(u);o.has(s)?o.delete(s):o.add(s),y(o)},H=(s,o=0)=>{s.images&&s.images.length>0&&I({images:s.images,initialIndex:o})},J=()=>{w(!0)};return e.jsxs("div",{className:"p-8 min-h-screen bg-[#1a2236] text-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("h1",{className:"text-2xl font-bold",children:["📦 ",l("navigation.products")]}),u.size>0&&e.jsxs("span",{className:"bg-blue-500 text-white px-3 py-1 rounded-full text-sm font-medium",children:[u.size," selected"]})]}),e.jsxs("div",{className:"flex gap-3",children:[u.size>0&&e.jsxs("button",{className:"bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg font-semibold",onClick:J,disabled:P.isPending,children:[e.jsx(j,{icon:"mdi:delete-sweep",className:"inline-block mr-2"}),"🗑️ Delete Selected (",u.size,")"]}),e.jsxs("button",{className:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold",onClick:_,children:[e.jsx(j,{icon:"mdi:plus",className:"inline-block mr-2"})," ➕ ",l("products.addProduct")]})]})]}),e.jsxs("div",{className:"mb-4 flex items-center",children:[e.jsx("input",{className:"bg-[#232b42] text-white px-4 py-2 rounded-lg w-80 focus:outline-none focus:ring",placeholder:`🔍 ${l("products.searchProduct")}`,value:p,onChange:s=>{N(s.target.value),c(1)}}),e.jsxs("span",{className:"ml-4 text-gray-400",children:["📊 ",l("navigation.dashboard")," • ",e.jsxs("span",{className:"bg-blue-900 text-blue-300 px-2 py-1 rounded text-xs ml-2",children:["📦 ",l("navigation.products")]})]})]}),e.jsx("div",{className:"bg-[#232b42] rounded-xl overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-[#2e3650]",children:[e.jsx("th",{className:"py-3 px-4",children:e.jsx("input",{type:"checkbox",checked:t?.data&&u.size===t.data.length,onChange:V,className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"})}),e.jsx("th",{className:"py-3 px-4",children:l("products.image")}),e.jsx("th",{className:"py-3 px-4",children:l("products.name")}),e.jsx("th",{className:"py-3 px-4",children:l("products.category")}),e.jsx("th",{className:"py-3 px-4",children:l("products.basePrice")}),e.jsx("th",{className:"py-3 px-4",children:l("products.baseStock")}),e.jsx("th",{className:"py-3 px-4 text-center",children:l("common.actions")})]})}),e.jsx("tbody",{children:r?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-8",children:"⏳ Loading..."})}):k?e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"text-center py-8 text-red-400",children:["❌ ",l("products.failedToLoadProducts")]})}):t?.data?.length?t?.data?.map(s=>e.jsxs("tr",{className:`border-b border-[#2e3650] hover:bg-[#202840] transition ${u.has(s._id)?"bg-blue-900 bg-opacity-30":""}`,children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("input",{type:"checkbox",checked:u.has(s._id),onChange:()=>W(s._id),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"})}),e.jsx("td",{className:"py-3 px-4",children:s.images&&s.images.length>0?e.jsx("img",{src:s.images[0],alt:"Product",className:"w-12 h-12 object-cover rounded cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>H(s,0),title:l("common.clickToPreview","Click to preview")}):e.jsx("span",{className:"text-gray-500 flex items-center justify-center",children:e.jsx(j,{icon:"mdi:image-off-outline",width:32,height:32})})}),e.jsx("td",{className:"py-3 px-4",children:s.name.uz}),e.jsx("td",{className:"py-3 px-4",children:L?.find(o=>o._id===s.categoryId)?.name.uz||e.jsx("span",{className:"text-red-400 italic",title:`Category ID: ${s.categoryId}`,children:"Unknown Category"})}),e.jsx("td",{className:"py-3 px-4",children:te(s.basePrice.toString())}),e.jsxs("td",{className:"py-3 px-4",children:[ae(s.baseStock.quantity.toString())," ",s.baseStock.unit]}),e.jsxs("td",{className:"py-3 px-4 text-center flex gap-3 justify-center",children:[e.jsx("button",{className:"hover:text-blue-400",title:l("common.edit"),onClick:()=>z(s),children:e.jsx(j,{icon:"mdi:pencil",width:18,height:18})}),e.jsx("button",{className:"hover:text-red-400",title:l("common.delete"),onClick:()=>K(s),children:e.jsx(j,{icon:"mdi:delete",width:18,height:18})})]})]},s._id)):e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-16 text-gray-400",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(j,{icon:"mdi:package-variant",className:"text-5xl mb-4"}),e.jsxs("div",{className:"text-lg font-medium",children:["📭 ",l("products.noProductsFound")]}),e.jsx("div",{className:"text-sm",children:l("products.clickAddProductToCreate")})]})})})})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:[l("common.itemsPerPage"),":"]}),e.jsx("select",{className:"bg-[#232b42] text-white px-2 py-1 rounded",value:d,onChange:s=>{v(Number(s.target.value)),c(1)},children:[5,10,20,50].map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("button",{className:"px-2 py-1 mx-1 rounded disabled:opacity-50",onClick:()=>c(1),disabled:a===1,children:"<<"}),e.jsx("button",{className:"px-2 py-1 mx-1 rounded disabled:opacity-50",onClick:()=>c(s=>Math.max(1,s-1)),disabled:a===1,children:"<"}),e.jsxs("span",{className:"mx-2",children:[a," / ",t?.meta?.totalPages??1]}),e.jsx("button",{className:"px-2 py-1 mx-1 rounded disabled:opacity-50",onClick:()=>c(s=>Math.min(t?.meta?.totalPages??1,s+1)),disabled:a===(t?.meta?.totalPages??1),children:">"}),e.jsx("button",{className:"px-2 py-1 mx-1 rounded disabled:opacity-50",onClick:()=>c(t?.meta?.totalPages??1),disabled:a===(t?.meta?.totalPages??1),children:">>"})]})]}),e.jsx(oe,{open:i,product:x||void 0,loading:f.isPending||E.isPending,error:f.isError?f.error?.message:E.isError?E.error?.message:null,onClose:()=>{n(!1),h(null)},onSubmit:s=>{const{images:o,imageUrls:D,...R}=s,q=o&&o.length>0&&o[0]instanceof File;if(x){const F=q?{...x,...R,images:o,imageUrls:D}:{...x,...R,imageUrls:D};E.mutate(F)}else{const F=q?{...R,images:o,imageUrls:D}:{...R,imageUrls:D};f.mutate(F)}}}),e.jsx(O,{open:!!b,title:`🗑️ ${l("products.deleteProduct")}`,description:b?`⚠️ ${l("modals.confirmDelete")} ${b.name.uz}?`:"",loading:U.isPending,onCancel:()=>C(null),onConfirm:()=>{b&&U.mutate(b)}}),e.jsx(O,{open:A,title:"🗑️ Bulk Delete Products",description:`⚠️ Are you sure you want to delete ${u.size} selected products? This action cannot be undone.`,loading:P.isPending,onCancel:()=>w(!1),onConfirm:()=>P.mutate(Array.from(u))}),e.jsx($,{open:!!S,images:S?.images||[],initialIndex:S?.initialIndex||0,onClose:()=>I(null)})]})};export{je as default};
