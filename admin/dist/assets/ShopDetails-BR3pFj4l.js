const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/leaflet-src-Buo02dPI.js","assets/index-BouADcV8.js","assets/index-hAnnmPxK.css"])))=>i.map(i=>d[i]);
import{r as a,e as V,R as te,_ as se,j as e,I as Q,u as oe,f as ue,d as me}from"./index-BouADcV8.js";import{u as Z}from"./index-DS6Sn0NB.js";import{u as X,a as xe,b as he,e as pe,f as ge,h as be}from"./shopService-CWGVHyjB.js";import{g as ye}from"./userService-CG63Svn2.js";import{S as fe,g as je}from"./ShopFormModal-ny_18lEM.js";import{u as K}from"./useMutation-Vq-BzWq0.js";import{u as Ne,g as ve}from"./orderService-CxOxZ2jg.js";import{a as W}from"./api-DwbFXHRK.js";import{M as q,S as ae,g as ne,f as Y,a as we}from"./units-B8aUyNEZ.js";import{I as Se}from"./ImagePreviewModal-jtcB2eMQ.js";import"./index.esm-A7arJavU.js";function ke({shopData:s,isLoading:h,error:i}){const[c,b]=a.useState(!1),[p,k]=a.useState(null),[v,f]=a.useState(!1),[m,y]=a.useState([]),[j,r]=a.useState(!1),[d,E]=a.useState(!1),[A,M]=a.useState(null),o=a.useRef(null),w=a.useRef(null),C=a.useRef(null),_=a.useRef(null),O=V(),[n,x]=a.useState(!1),[T,l]=a.useState(null),[P,N]=a.useState(!1),{data:$}=Z({queryKey:["users",1,1e3,""],queryFn:()=>ye(1,1e3,"")}),U=te.useMemo(()=>{const u={};return $?.data?.forEach(S=>{u[S._id]=S}),u},[$]);a.useEffect(()=>{if(s?.address?.coordinates){const{lat:u,lng:S}=s.address.coordinates;typeof u=="number"&&typeof S=="number"&&se(()=>import("./leaflet-src-Buo02dPI.js").then(L=>L.l),__vite__mapDeps([0,1,2])).then(L=>{o.current?(o.current.setView([u,S],16),o.current.dragging.enable(),o.current.scrollWheelZoom.enable(),o.current.doubleClickZoom[c?"disable":"enable"](),o.current.boxZoom[c?"disable":"enable"](),o.current.keyboard[c?"disable":"enable"]()):(o.current=L.map("shop-map",{dragging:!0,scrollWheelZoom:!0,doubleClickZoom:!c,boxZoom:!c,keyboard:!c}).setView([u,S],16),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(o.current),w.current=L.marker([u,S]).addTo(o.current).bindPopup(s.name).openPopup()),C.current&&(o.current.removeLayer(C.current),C.current=null);const R=s.deliveryZones?.[0];!c&&R&&R.polygon&&R.polygon.length>2&&(C.current=L.polygon(R.polygon.map(z=>[z.lat,z.lng]),{color:"blue"}).addTo(o.current),o.current.fitBounds(C.current.getBounds())),_.current&&(o.current.removeLayer(_.current),_.current=null),d&&w.current&&(o.current.removeLayer(w.current),w.current=null),d&&A?w.current=L.marker([A.lat,A.lng]).addTo(o.current).bindPopup("New Location").openPopup():d||(w.current&&o.current.removeLayer(w.current),w.current=L.marker([u,S]).addTo(o.current).bindPopup(s.name).openPopup()),c?o.current.on("click",F):o.current.off("click",F),d?o.current.on("click",G):o.current.off("click",G)})}return()=>{}},[s,c,d,A]);const F=u=>{y(S=>[...S,{lat:u.latlng.lat,lng:u.latlng.lng}])},G=u=>{M({lat:u.latlng.lat,lng:u.latlng.lng})};a.useEffect(()=>{o.current&&(_.current&&(o.current.removeLayer(_.current),_.current=null),c&&m.length>0&&se(()=>import("./leaflet-src-Buo02dPI.js").then(u=>u.l),__vite__mapDeps([0,1,2])).then(u=>{_.current=u.polygon(m.map(S=>[S.lat,S.lng]),{color:"red",dashArray:"5, 5"}).addTo(o.current)}))},[m,c]),a.useEffect(()=>()=>{o.current&&(o.current.remove(),o.current=null)},[]);const H=async()=>{if(!(!p||!s?._id)){x(!0),l(null),N(!1);try{await X({_id:s._id,deliveryZones:[{name:"Default Zone",polygon:p,deliveryFee:s.deliveryZones?.[0]?.deliveryFee||0,minOrderAmount:s.deliveryZones?.[0]?.minOrderAmount||0,estimatedDeliveryTime:s.deliveryZones?.[0]?.estimatedDeliveryTime||0}]}),N(!0),O.invalidateQueries({queryKey:["shop",s._id]})}catch(u){l(u?.message||"Failed to save region")}finally{x(!1)}}},B=async()=>{if(!(!A||!s?._id)){x(!0),l(null),N(!1);try{await X({_id:s._id,address:{...s.address,coordinates:A}}),N(!0),E(!1),M(null),O.invalidateQueries({queryKey:["shop",s._id]})}catch(u){l(u?.message||"Failed to save location")}finally{x(!1)}}};return h?e.jsx("div",{children:"Loading..."}):i?e.jsx("div",{className:"text-red-400",children:String(i.message)}):s?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 mb-4",children:[s.photo&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Shop Photo:"}),e.jsx("img",{src:s.photo,alt:"Shop photo",className:"w-32 h-32 object-cover rounded border"})]}),s.logo&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Shop Logo:"}),e.jsx("img",{src:s.logo,alt:"Shop logo",className:"w-32 h-32 object-cover rounded border"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Name:"})," ",s.name]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Owner:"})," ",U[s.ownerId]&&(`${U[s.ownerId].firstName||""} ${U[s.ownerId].lastName||""}`.trim()||U[s.ownerId].username)||s.ownerId]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Phone:"})," ",s.contactInfo?.phoneNumber]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"City:"})," ",s.address?.city]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Status:"})," ",e.jsx("span",{className:"capitalize",children:s.status})]}),e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsx("button",{className:"bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded font-semibold",onClick:()=>{b(!c),y([]),f(!1),N(!1),l(null)},children:c?"Cancel Edit":"Edit Delivery Region"}),e.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded font-semibold",onClick:()=>r(!0),children:"✏️ Edit Shop"}),e.jsx("button",{className:"bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded font-semibold",onClick:()=>{E(!d),M(null),N(!1),l(null)},children:d?"Cancel Location Edit 📍":"Edit Location 📍"}),d&&A&&e.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-semibold",onClick:B,disabled:n,children:n?"Saving...":"Save Location"}),c&&m.length>2&&e.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-semibold",onClick:()=>{k(m),b(!1),f(!1)},children:"Finish Polygon"}),!c&&p&&e.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded font-semibold",onClick:H,disabled:n,children:n?"Saving...":"Save Region"})]}),T&&e.jsx("div",{className:"text-red-400 mt-2",children:T}),P&&e.jsx("div",{className:"text-green-400 mt-2",children:"Saved successfully!"}),e.jsx("div",{className:"mt-6",children:s?.address?.coordinates&&typeof s.address.coordinates.lat=="number"&&typeof s.address.coordinates.lng=="number"?e.jsxs(e.Fragment,{children:[e.jsx("style",{children:".leaflet-container, .leaflet-control { z-index: 10 !important; }"}),e.jsx("div",{id:"shop-map",style:{height:350,width:"100%",borderRadius:12,overflow:"hidden",zIndex:10,position:"relative"}}),d&&e.jsx("div",{className:"text-sm text-blue-300 mt-2",children:"Tip: Drag and zoom the map to find the right spot, then click to set the new shop location. 🗺️"})]}):e.jsx("div",{className:"text-gray-400",children:"No location data for this shop."})}),e.jsx(fe,{open:j,mode:"edit",initialValues:s,onClose:()=>r(!1),onSubmit:async u=>{x(!0),l(null),N(!1);try{console.log("ShopInfoTab edit - Received values:",u);const S=u.photoFile||u.logoFile,L=u.removePhoto||u.removeLogo;if(S||L)console.log("ShopInfoTab edit - File uploads or remove flags detected, sending values directly"),await X(u);else{const R=je(s,u),z={...R,_id:s._id};console.log("ShopInfoTab edit - Original:",s),console.log("ShopInfoTab edit - Changes:",R),console.log("ShopInfoTab edit - Sending:",z),await X(z)}r(!1),N(!0),O.invalidateQueries({queryKey:["shop",s._id]})}catch(S){l(S?.message||"Failed to update shop")}finally{x(!1)}}})]}):e.jsx("div",{children:"No shop data found."})}function I(s){const h=typeof s=="string"?parseFloat(s):s;return isNaN(h)?"":h.toLocaleString("en-US").replace(/,/g," ")}function Ce({order:s,isOpen:h,onClose:i,onUpdate:c}){const[b,p]=a.useState(s?.status||""),[k,v]=a.useState(s?.adminNotes||""),[f,m]=a.useState(!1);te.useEffect(()=>{s&&(p(s.status),v(s.adminNotes||""))},[s]);const y=async()=>{if(s){m(!0);try{await c(s._id,{status:b,adminNotes:k}),i()}catch(j){console.error("Failed to update order:",j)}finally{m(!1)}}};return!h||!s?null:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-[#232b42] rounded-xl p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-white",children:["Order Details #",s.orderNumber]}),e.jsx("button",{onClick:i,className:"text-gray-400 hover:text-white text-2xl",children:"×"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-[#1a2236] p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Order Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Order Number:"}),e.jsxs("span",{className:"text-white font-mono",children:["#",s.orderNumber]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Customer ID:"}),e.jsx("span",{className:"text-white",children:s.customerId})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Payment Method:"}),e.jsx("span",{className:"text-white capitalize",children:s.paymentMethod.replace("_"," ")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Payment Status:"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs ${s.paymentStatus==="paid"?"bg-green-600":s.paymentStatus==="failed"?"bg-red-600":"bg-yellow-600"}`,children:s.paymentStatus})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Created:"}),e.jsx("span",{className:"text-white",children:new Date(s.createdAt).toLocaleDateString()})]})]})]}),e.jsxs("div",{className:"bg-[#1a2236] p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Delivery Address"}),e.jsxs("div",{className:"text-sm text-gray-300",children:[e.jsx("p",{children:s.deliveryAddress.street}),e.jsxs("p",{children:[s.deliveryAddress.district,", ",s.deliveryAddress.city]}),s.deliveryAddress.notes&&e.jsxs("p",{className:"mt-2 text-gray-400",children:["Notes: ",s.deliveryAddress.notes]})]})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-[#1a2236] p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Order Items"}),e.jsx("div",{className:"space-y-2",children:s.items.map((j,r)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-[#232b42] rounded",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white font-medium",children:j.name}),e.jsxs("p",{className:"text-gray-400 text-sm",children:[j.quantity," ",j.unit," × ",I(j.price)]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-white font-semibold",children:I(j.subtotal)})})]},r))}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-600",children:e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Items Total:"}),e.jsx("span",{className:"text-white",children:I(s.pricing.itemsTotal)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Delivery Fee:"}),e.jsx("span",{className:"text-white",children:I(s.pricing.deliveryFee)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Service Fee:"}),e.jsx("span",{className:"text-white",children:I(s.pricing.serviceFee)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Tax:"}),e.jsx("span",{className:"text-white",children:I(s.pricing.tax)})]}),s.pricing.discount>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Discount:"}),e.jsxs("span",{className:"text-red-400",children:["-",I(s.pricing.discount)]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold border-t border-gray-600 pt-2",children:[e.jsx("span",{className:"text-white",children:"Total:"}),e.jsx("span",{className:"text-cyan-400",children:I(s.pricing.total)})]})]})})]})})]}),e.jsxs("div",{className:"mt-6 bg-[#1a2236] p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Status Management"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Order Status"}),e.jsxs("select",{value:b,onChange:j=>p(j.target.value),className:"w-full bg-[#232b42] border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-cyan-400",children:[e.jsx("option",{value:"created",children:"Created"}),e.jsx("option",{value:"operator_confirmed",children:"Operator Confirmed"}),e.jsx("option",{value:"packing",children:"Packing"}),e.jsx("option",{value:"packed",children:"Packed"}),e.jsx("option",{value:"courier_picked",children:"Courier Picked"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"rejected_by_shop",children:"Rejected by Shop"}),e.jsx("option",{value:"rejected_by_courier",children:"Rejected by Courier"}),e.jsx("option",{value:"cancelled_by_client",children:"Cancelled by Client"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Admin Notes"}),e.jsx("textarea",{value:k,onChange:j=>v(j.target.value),rows:3,className:"w-full bg-[#232b42] border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-cyan-400",placeholder:"Add admin notes..."})]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{onClick:i,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:y,disabled:f,className:"px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors disabled:opacity-50",children:f?"Updating...":"Update Order"})]})]})})}function Pe({shopId:s}){const[h,i]=a.useState(null),[c,b]=a.useState(!1),[p,k]=a.useState(""),[v,f]=a.useState("all"),[m,y]=a.useState(1),j=V(),{data:r,isLoading:d,error:E}=Z({queryKey:["shop-orders",s,m],queryFn:()=>ve(s,m,20),enabled:!!s}),A=K({mutationFn:({orderId:n,updates:x})=>Ne({_id:n,...x}),onSuccess:()=>{j.invalidateQueries({queryKey:["shop-orders",s]})}}),M=async(n,x)=>{await A.mutateAsync({orderId:n,updates:x})},o=n=>{i(n),b(!0)},w=()=>{b(!1),i(null)},C=a.useMemo(()=>r?.data?r.data.filter(x=>{const T=p===""||x.orderNumber.toLowerCase().includes(p.toLowerCase())||x.customerId.toLowerCase().includes(p.toLowerCase()),l=v==="all"||x.status===v;return T&&l}).sort((x,T)=>new Date(T.createdAt).getTime()-new Date(x.createdAt).getTime()):[],[r?.data,p,v]),_=n=>({created:"bg-gray-500",operator_confirmed:"bg-blue-500",packing:"bg-yellow-500",packed:"bg-orange-500",courier_picked:"bg-purple-500",delivered:"bg-green-500",paid:"bg-emerald-500",rejected_by_shop:"bg-red-500",rejected_by_courier:"bg-red-500",cancelled_by_client:"bg-gray-400"})[n]||"bg-gray-500",O=n=>({created:"mdi:file-document-outline",operator_confirmed:"mdi:check-circle-outline",packing:"mdi:package-variant",packed:"mdi:package-variant-closed",courier_picked:"mdi:truck-delivery-outline",delivered:"mdi:check-circle",paid:"mdi:cash-multiple",rejected_by_shop:"mdi:close-circle",rejected_by_courier:"mdi:close-circle",cancelled_by_client:"mdi:cancel"})[n]||"mdi:help-circle";return d?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Loading orders..."})]})}):E?e.jsx("div",{className:"text-center py-8",children:e.jsxs("div",{className:"text-red-400 mb-2",children:[e.jsx(Q,{icon:"mdi:alert-circle",className:"text-4xl mx-auto mb-2"}),e.jsxs("p",{children:["Error loading orders: ",String(E.message)]})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(Q,{icon:"mdi:cart-outline",className:"text-2xl"}),"Shop Orders"]}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Manage and track all orders for this shop"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[e.jsx(Q,{icon:"mdi:information-outline",className:"text-lg"}),e.jsxs("span",{children:[C.length," orders found"]})]})]}),e.jsx("div",{className:"bg-[#1a2236] p-4 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Search Orders"}),e.jsxs("div",{className:"relative",children:[e.jsx(Q,{icon:"mdi:magnify",className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:p,onChange:n=>k(n.target.value),placeholder:"Search by order number or customer ID...",className:"w-full pl-10 pr-4 py-2 bg-[#232b42] border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-cyan-400"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Status Filter"}),e.jsxs("select",{value:v,onChange:n=>f(n.target.value),className:"w-full px-3 py-2 bg-[#232b42] border border-gray-600 rounded-lg text-white focus:outline-none focus:border-cyan-400",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"created",children:"Created"}),e.jsx("option",{value:"operator_confirmed",children:"Operator Confirmed"}),e.jsx("option",{value:"packing",children:"Packing"}),e.jsx("option",{value:"packed",children:"Packed"}),e.jsx("option",{value:"courier_picked",children:"Courier Picked"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"rejected_by_shop",children:"Rejected by Shop"}),e.jsx("option",{value:"rejected_by_courier",children:"Rejected by Courier"}),e.jsx("option",{value:"cancelled_by_client",children:"Cancelled by Client"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{onClick:()=>{k(""),f("all")},className:"w-full px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(Q,{icon:"mdi:refresh",className:"text-lg"}),"Clear Filters"]})})]})}),C.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Q,{icon:"mdi:package-variant-closed",className:"text-6xl text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-400 mb-2",children:"No Orders Found"}),e.jsx("p",{className:"text-gray-500",children:p||v!=="all"?"Try adjusting your search criteria or filters.":"This shop has no orders yet."})]}):e.jsx("div",{className:"bg-[#1a2236] rounded-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-[#232b42]",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Order Details"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Customer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:C.map(n=>e.jsxs("tr",{className:"hover:bg-[#232b42] transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-white",children:["#",n.orderNumber]}),e.jsxs("div",{className:"text-sm text-gray-400",children:[n.items.length," item",n.items.length!==1?"s":""]})]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm text-white",children:n.customerId}),e.jsxs("div",{className:"text-sm text-gray-400",children:[n.deliveryAddress.city,", ",n.deliveryAddress.district]})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${_(n.status)}`,children:[e.jsx(Q,{icon:O(n.status),className:"mr-1"}),n.status.replace("_"," ")]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm font-semibold text-cyan-400",children:I(n.pricing.total)}),e.jsx("div",{className:"text-xs text-gray-400",children:n.paymentStatus})]}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm text-white",children:new Date(n.createdAt).toLocaleDateString()}),e.jsx("div",{className:"text-xs text-gray-400",children:new Date(n.createdAt).toLocaleTimeString()})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("button",{onClick:()=>o(n),className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-cyan-400 bg-cyan-400 bg-opacity-10 hover:bg-opacity-20 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-400 transition-colors",children:[e.jsx(Q,{icon:"mdi:eye",className:"mr-1"}),"View Details"]})})]},n._id))})]})})}),r?.meta&&r.meta.totalPages>1&&e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>y(Math.max(1,m-1)),disabled:m===1,className:"px-3 py-2 bg-[#232b42] text-white rounded-lg hover:bg-[#1a2236] disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsxs("span",{className:"px-3 py-2 text-gray-400",children:["Page ",m," of ",r.meta.totalPages]}),e.jsx("button",{onClick:()=>y(Math.min(r.meta.totalPages,m+1)),disabled:m===r.meta.totalPages,className:"px-3 py-2 bg-[#232b42] text-white rounded-lg hover:bg-[#1a2236] disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})}),e.jsx(Ce,{order:h,isOpen:c,onClose:w,onUpdate:M})]})}function Ae({shopId:s}){const[h,i]=a.useState(""),[c,b]=a.useState(null),[p,k]=a.useState(null),[v,f]=a.useState(null),[m,y]=a.useState(null),[j,r]=a.useState(!1),[d,E]=a.useState("");V();const{data:A,isLoading:M,error:o,refetch:w}=Z({queryKey:["shop-assigned-couriers",s],queryFn:()=>pe(s),enabled:!!s}),{data:C,isLoading:_,error:O,refetch:n}=Z({queryKey:["shop-available-couriers",s,h],queryFn:async()=>{const l=await ge(s),P=h.trim().toLowerCase();return{data:(l.data||[]).filter(N=>P?N.firstName&&N.firstName.toLowerCase().includes(P)||N.lastName&&N.lastName.toLowerCase().includes(P)||N.username&&N.username.toLowerCase().includes(P)||N.phoneNumber&&N.phoneNumber.includes(P):!0)}},enabled:!!s}),x=K({mutationFn:async l=>{b(l),f(null),await xe(s,l)},onSuccess:()=>{b(null),w(),n()},onError:l=>{f(l?.message||"Failed to assign courier"),b(null)}}),T=K({mutationFn:async l=>{k(l),y(null),await he(s,l)},onSuccess:()=>{k(null),w(),n()},onError:l=>{y(l?.message||"Failed to unassign courier"),k(null)}});return e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Assigned Couriers 🚚"}),e.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-semibold mb-4",onClick:()=>r(!0),children:"Add Courier ➕"}),M?e.jsx("div",{children:"Loading assigned couriers..."}):o?e.jsx("div",{className:"text-red-400",children:String(o.message)}):A?.data?.length?e.jsxs("table",{className:"min-w-full text-left bg-[#232b42] rounded-lg mb-6",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-4",children:"#"}),e.jsx("th",{className:"py-2 px-4",children:"Name"}),e.jsx("th",{className:"py-2 px-4",children:"Actions"})]})}),e.jsx("tbody",{children:A.data.map((l,P)=>e.jsxs("tr",{className:"border-b border-[#2e3650]",children:[e.jsx("td",{className:"py-2 px-4",children:P+1}),e.jsxs("td",{className:"py-2 px-4",children:[l.firstName," ",l.lastName]}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("button",{className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded font-semibold",disabled:p===l._id,onClick:()=>T.mutate(l._id),title:"Unassign Courier",children:p===l._id?"Unassigning...":"Unassign ❌"})})]},l._id))})]}):e.jsx("div",{className:"text-gray-400",children:"No couriers assigned to this shop."}),m&&e.jsxs("div",{className:"text-red-400 mb-2",children:[m," ❗"]}),j&&e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm transition-all",style:{backdropFilter:"blur(8px)"},onClick:()=>r(!1)}),e.jsxs("div",{className:"fixed top-0 right-0 h-full w-full max-w-md bg-[#232b42] shadow-2xl p-8 overflow-y-auto transition-transform duration-300 transform translate-x-0",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Add Courier to Shop"}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{className:"bg-[#232b42] text-white px-4 py-2 rounded-lg w-full focus:outline-none focus:ring mb-2",placeholder:"Search available couriers...",value:d,onChange:l=>E(l.target.value)})}),_?e.jsx("div",{children:"Loading available couriers..."}):O?e.jsx("div",{className:"text-red-400",children:String(O.message)}):C?.data?.length?e.jsxs("table",{className:"min-w-full text-left bg-[#232b42] rounded-lg mb-2",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-4",children:"#"}),e.jsx("th",{className:"py-2 px-4",children:"Name"}),e.jsx("th",{className:"py-2 px-4",children:"Action"})]})}),e.jsx("tbody",{children:C.data?.filter(l=>{const P=d.trim().toLowerCase();return P?l.firstName&&l.firstName.toLowerCase().includes(P)||l.lastName&&l.lastName.toLowerCase().includes(P):!0}).map((l,P)=>e.jsxs("tr",{className:"border-b border-[#2e3650]",children:[e.jsx("td",{className:"py-2 px-4",children:P+1}),e.jsxs("td",{className:"py-2 px-4",children:[l.firstName," ",l.lastName]}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded font-semibold",disabled:c===l._id,onClick:()=>x.mutate(l._id),title:"Assign Courier",children:c===l._id?"Assigning...":"Assign ➕"})})]},l._id))})]}):e.jsx("div",{className:"text-gray-400",children:"No available couriers found."}),v&&e.jsxs("div",{className:"text-red-400 mb-2",children:[v," ❗"]}),e.jsx("div",{className:"flex justify-end gap-2 mt-6",children:e.jsx("button",{className:"px-4 py-2 rounded bg-gray-600 hover:bg-gray-700",onClick:()=>r(!1),children:"Close"})})]})]})]})}const _e=async(s,h=1,i=10,c="")=>{const b=new URLSearchParams({page:String(h),limit:String(i),shopId:s});return c&&b.append("search",c),(await W.get(`/shop-products?${b.toString()}`)).data},Oe=async(s,h,i)=>(await W.post("/shop-products",{shopId:s,productId:h,...i})).data.data,Fe=async(s,h)=>(await W.put(`/shop-products/${s}`,h)).data.data,Le=async s=>{await W.delete(`/shop-products/${s}`)},Te=async(s,h=1,i=10,c="")=>{const b=new URLSearchParams({page:String(h),limit:String(i),shopId:s});return c&&b.append("search",c),(await W.get(`/shop-products/available?${b.toString()}`)).data};function Ee({open:s,mode:h,initialValues:i,loading:c,error:b,onClose:p,onSubmit:k}){const{t:v}=oe(),f=h==="edit",[m,y]=a.useState({price:0,stock:{quantity:0,unit:"pcs"},isActive:!0,isRefundable:!1,maxOrderQuantity:void 0,minOrderQuantity:1,deliveryTime:void 0,specialNotes:""});a.useEffect(()=>{s&&i&&y({price:i.price||0,stock:i.stock||{quantity:0,unit:"pcs"},isActive:i.isActive??!0,isRefundable:i.isRefundable??!1,maxOrderQuantity:i.maxOrderQuantity,minOrderQuantity:i.minOrderQuantity||1,deliveryTime:i.deliveryTime,specialNotes:i.specialNotes||""})},[s,i]);const j=r=>{r.preventDefault(),k(m)};return s?e.jsxs("div",{className:"fixed inset-0 z-[9999]",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm transition-all z-[9999]",style:{backdropFilter:"blur(8px)"},onClick:p}),e.jsxs("div",{className:"fixed top-0 right-0 h-full w-full max-w-xl bg-[#232b42] shadow-2xl p-8 overflow-y-auto transition-transform duration-300 transform translate-x-0 z-[99999]",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-white",children:f?"✏️ Edit Shop Product":"➕ Add Shop Product"}),b&&e.jsxs("div",{className:"text-red-400 mb-4",children:["❌ ",b]}),i?.product&&e.jsxs("div",{className:"bg-[#1a2236] p-4 rounded-lg mb-4",children:[e.jsxs("h3",{className:"font-semibold mb-2 text-white",children:["Product: ",i.product.name?.uz||i.product.name?.ru||"N/A"]}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Base Price: ",i.product.basePrice?`$${i.product.basePrice}`:"N/A"]})]}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-white",children:"Shop Price 💰"}),e.jsx(q,{type:"price",value:m.price,onChange:r=>y(d=>({...d,price:r})),placeholder:"Enter shop price",className:"bg-[#1a2236] text-white px-4 py-2 rounded-lg w-full focus:outline-none focus:ring"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-white",children:"Stock Quantity 📦"}),e.jsx(q,{type:"number",value:m.stock.quantity,onChange:r=>y(d=>({...d,stock:{...d.stock,quantity:r}})),placeholder:"Quantity",className:"bg-[#1a2236] text-white px-4 py-2 rounded-lg w-full focus:outline-none focus:ring"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-white",children:"Unit 📏"}),e.jsx(ae,{value:m.stock.unit,onChange:r=>y(d=>({...d,stock:{...d.stock,unit:r}})),options:ne(),placeholder:"Select unit",className:"w-full"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-white",children:"Min Order Quantity 📋"}),e.jsx(q,{type:"number",value:m.minOrderQuantity,onChange:r=>y(d=>({...d,minOrderQuantity:r})),placeholder:"Min order",className:"bg-[#1a2236] text-white px-4 py-2 rounded-lg w-full focus:outline-none focus:ring"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-white",children:"Max Order Quantity 📋"}),e.jsx(q,{type:"number",value:m.maxOrderQuantity||0,onChange:r=>y(d=>({...d,maxOrderQuantity:r||void 0})),placeholder:"Max order (optional)",className:"bg-[#1a2236] text-white px-4 py-2 rounded-lg w-full focus:outline-none focus:ring"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-white",children:"Delivery Time (minutes) ⏱️"}),e.jsx(q,{type:"number",value:m.deliveryTime||0,onChange:r=>y(d=>({...d,deliveryTime:r||void 0})),placeholder:"Delivery time in minutes (optional)",className:"bg-[#1a2236] text-white px-4 py-2 rounded-lg w-full focus:outline-none focus:ring"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-white",children:"Special Notes 📝"}),e.jsx("textarea",{value:m.specialNotes,onChange:r=>y(d=>({...d,specialNotes:r.target.value})),className:"bg-[#1a2236] text-white px-4 py-2 rounded-lg w-full focus:outline-none focus:ring",placeholder:"Special notes about this product (optional)",rows:3})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:m.isActive,onChange:r=>y(d=>({...d,isActive:r.target.checked})),className:"mr-2"}),e.jsx("span",{className:"text-sm text-white",children:"Active in shop"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:m.isRefundable,onChange:r=>y(d=>({...d,isRefundable:r.target.checked})),className:"mr-2"}),e.jsx("span",{className:"text-sm text-white",children:"Refundable"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx("button",{type:"button",className:"px-4 py-2 rounded bg-gray-600 hover:bg-gray-700 text-white",onClick:p,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-blue-600 hover:bg-blue-700 text-white",disabled:c,children:c?"Saving...":f?"Update Product":"Add Product"})]})]})]})]}):null}function Me({shopId:s}){const[h,i]=a.useState(1),[c,b]=a.useState(""),[p]=a.useState(10),[k,v]=a.useState(!1),[f,m]=a.useState(""),[y,j]=a.useState(null),[r,d]=a.useState(null),[E,A]=a.useState(null),[M,o]=a.useState(null),[w,C]=a.useState(null),[_,O]=a.useState(!1),[n,x]=a.useState({price:0,stock:{quantity:0,unit:"pcs"},isActive:!0,isRefundable:!0,minOrderQuantity:1}),[T,l]=a.useState(null),[P,N]=a.useState(!1),[$,U]=a.useState(null);V();const{data:F,isLoading:G,error:H,refetch:B}=Z({queryKey:["shop-products",s,h,p,c],queryFn:()=>_e(s,h,p,c),enabled:!!s}),{data:u,isLoading:S,error:L,refetch:R}=Z({queryKey:["available-products-for-shop",s,f],queryFn:()=>Te(s,1,50,f),enabled:!!s&&k}),z=K({mutationFn:async t=>{j(t),A(null),await Oe(s,t,n)},onSuccess:()=>{j(null),O(!1),C(null),x({price:0,stock:{quantity:0,unit:"pcs"},isActive:!0,isRefundable:!0,minOrderQuantity:1}),B(),R()},onError:t=>{A(t?.message||"Failed to assign product"),j(null)}}),le=K({mutationFn:async t=>{d(t),o(null),await Le(t)},onSuccess:()=>{d(null),B(),R()},onError:t=>{o(t?.message||"Failed to remove product"),d(null)}}),J=K({mutationFn:async({shopProductId:t,data:g})=>{await Fe(t,g)},onSuccess:()=>{N(!1),l(null),B()},onError:t=>{console.error("Failed to update shop product:",t)}}),re=t=>{t.preventDefault(),i(1)},ie=t=>{C(t),x({price:t.basePrice||0,stock:{quantity:t.baseStock?.quantity||0,unit:t.baseStock?.unit||"pcs"},isActive:!0,isRefundable:!0,minOrderQuantity:1}),O(!0)},ee=t=>{t.preventDefault(),w&&z.mutate(w._id)},ce=t=>{l(t),N(!0)},de=(t,g=0)=>{t.product?.images&&t.product.images.length>0&&U({images:t.product.images,initialIndex:g})},D=(t,g="N/A")=>t?typeof t=="string"?t:t.uz?t.uz:t.ru?t.ru:g:g;return G?e.jsx("div",{children:"Loading shop products..."}):H?e.jsx("div",{className:"text-red-400",children:String(H.message)}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Shop Products 🛍️"}),e.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-semibold",onClick:()=>v(!0),children:"Add Product ➕"})]}),e.jsx("form",{onSubmit:re,className:"mb-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Search shop products...",value:c,onChange:t=>b(t.target.value),className:"flex-1 bg-[#232b42] text-white px-4 py-2 rounded-lg focus:outline-none focus:ring"}),e.jsx("button",{type:"submit",className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg",children:"Search 🔍"})]})}),F?.data?.length?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-[#232b42] rounded-lg overflow-hidden",children:e.jsxs("table",{className:"min-w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#1a2236]",children:[e.jsx("th",{className:"py-3 px-4",children:"Image"}),e.jsx("th",{className:"py-3 px-4",children:"Name"}),e.jsx("th",{className:"py-3 px-4",children:"Category"}),e.jsx("th",{className:"py-3 px-4",children:"Shop Price"}),e.jsx("th",{className:"py-3 px-4",children:"Stock"}),e.jsx("th",{className:"py-3 px-4",children:"Status"}),e.jsx("th",{className:"py-3 px-4",children:"Actions"})]})}),e.jsx("tbody",{children:Array.isArray(F.data)&&F.data.map(t=>e.jsxs("tr",{className:"border-b border-[#2e3650] hover:bg-[#2e3650]",children:[e.jsx("td",{className:"py-3 px-4",children:t.product?.images&&t.product.images.length>0?e.jsx("img",{src:t.product.images[0],alt:D(t.product?.name),className:"w-12 h-12 object-cover rounded cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>de(t,0),title:"Click to preview"}):e.jsx("div",{className:"w-12 h-12 bg-gray-600 rounded flex items-center justify-center",children:"📷"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:D(t.product?.name)}),e.jsx("div",{className:"text-sm text-gray-400",children:D(t.product?.description)})]})}),e.jsx("td",{className:"py-3 px-4",children:t.product?.categoryId?e.jsx("span",{className:"bg-blue-600 text-white px-2 py-1 rounded text-xs",children:t.product.categoryId}):e.jsx("span",{className:"text-gray-400",children:"No category"})}),e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("span",{className:"font-medium",children:Y(t.price.toString())}),t.product?.basePrice&&t.price!==t.product.basePrice&&e.jsxs("div",{className:"text-xs text-gray-400",children:["Base: ",Y(t.product.basePrice.toString())]})]}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:we((t.stock?.quantity||0).toString())}),e.jsxs("span",{className:"text-sm text-gray-400",children:[" ",t.stock?.unit||"pcs"]})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${t.isActive?"bg-green-600 text-white":"bg-red-600 text-white"}`,children:t.isActive?"Active":"Inactive"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm",title:"Edit Shop Product",onClick:()=>ce(t),children:"Edit ✏️"}),e.jsx("button",{className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm",disabled:r===t._id,onClick:()=>le.mutate(t._id),title:"Remove from Shop",children:r===t._id?"Removing...":"Remove 🗑️"})]})})]},t._id))})]})}),F.meta&&F.meta.totalPages>1&&e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-400",children:["Showing ",(h-1)*p+1," to ",Math.min(h*p,F.meta.total)," of ",F.meta.total," products"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>i(t=>Math.max(1,t-1)),disabled:h===1,className:"px-3 py-1 bg-[#232b42] text-white rounded disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsxs("span",{className:"px-3 py-1 bg-[#232b42] text-white rounded",children:[h," of ",F.meta.totalPages]}),e.jsx("button",{onClick:()=>i(t=>Math.min(F.meta.totalPages,t+1)),disabled:h===F.meta.totalPages,className:"px-3 py-1 bg-[#232b42] text-white rounded disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]}):e.jsx("div",{className:"text-gray-400",children:"No products assigned to this shop."}),M&&e.jsxs("div",{className:"text-red-400 mt-2",children:[M," ❗"]}),k&&e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm transition-all",style:{backdropFilter:"blur(8px)"},onClick:()=>{v(!1),O(!1),C(null)}}),e.jsxs("div",{className:"fixed top-0 right-0 h-full w-full max-w-md bg-[#232b42] shadow-2xl p-8 overflow-y-auto transition-transform duration-300 transform translate-x-0",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:_?"Configure Product for Shop":"Add Product to Shop"}),_?e.jsxs("form",{onSubmit:ee,className:"space-y-4",children:[w&&e.jsxs("div",{className:"bg-[#1a2236] p-4 rounded-lg mb-4",children:[e.jsxs("h3",{className:"font-semibold mb-2",children:["Product: ",D(w.name)]}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Base Price: ",Y(w.basePrice.toString())]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Shop Price 💰"}),e.jsx(q,{type:"price",value:n.price,onChange:t=>x(g=>({...g,price:t})),placeholder:"Enter shop price",className:"bg-[#1a2236] text-white px-4 py-2 rounded-lg w-full focus:outline-none focus:ring"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Stock Quantity 📦"}),e.jsx(q,{type:"number",value:n.stock.quantity,onChange:t=>x(g=>({...g,stock:{...g.stock,quantity:t}})),placeholder:"Quantity",className:"bg-[#1a2236] text-white px-4 py-2 rounded-lg w-full focus:outline-none focus:ring"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Unit 📏"}),e.jsx(ae,{value:n.stock.unit,onChange:t=>x(g=>({...g,stock:{...g.stock,unit:t}})),options:ne(),placeholder:"Select unit",className:"w-full"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Min Order Quantity 📋"}),e.jsx(q,{type:"number",value:n.minOrderQuantity,onChange:t=>x(g=>({...g,minOrderQuantity:t})),placeholder:"Min order",className:"bg-[#1a2236] text-white px-4 py-2 rounded-lg w-full focus:outline-none focus:ring"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Max Order Quantity 📋"}),e.jsx(q,{type:"number",value:n.maxOrderQuantity||0,onChange:t=>x(g=>({...g,maxOrderQuantity:t||void 0})),placeholder:"Max order (optional)",className:"bg-[#1a2236] text-white px-4 py-2 rounded-lg w-full focus:outline-none focus:ring"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Delivery Time (minutes) ⏱️"}),e.jsx(q,{type:"number",value:n.deliveryTime||0,onChange:t=>x(g=>({...g,deliveryTime:t||void 0})),placeholder:"Delivery time in minutes (optional)",className:"bg-[#1a2236] text-white px-4 py-2 rounded-lg w-full focus:outline-none focus:ring"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Special Notes 📝"}),e.jsx("textarea",{value:n.specialNotes||"",onChange:t=>x(g=>({...g,specialNotes:t.target.value})),className:"bg-[#1a2236] text-white px-4 py-2 rounded-lg w-full focus:outline-none focus:ring",placeholder:"Special notes about this product (optional)",rows:3})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:n.isActive,onChange:t=>x(g=>({...g,isActive:t.target.checked})),className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"Active in shop"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:n.isRefundable,onChange:t=>x(g=>({...g,isRefundable:t.target.checked})),className:"mr-2"}),e.jsx("span",{className:"text-sm",children:"Refundable"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4",children:e.jsx("input",{className:"bg-[#232b42] text-white px-4 py-2 rounded-lg w-full focus:outline-none focus:ring mb-2",placeholder:"Search available products...",value:f,onChange:t=>m(t.target.value)})}),S?e.jsx("div",{children:"Loading available products..."}):L?e.jsx("div",{className:"text-red-400",children:String(L.message)}):u?.data?.length?e.jsxs("table",{className:"min-w-full text-left bg-[#232b42] rounded-lg mb-2",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-4",children:"#"}),e.jsx("th",{className:"py-2 px-4",children:"Name"}),e.jsx("th",{className:"py-2 px-4",children:"Base Price"}),e.jsx("th",{className:"py-2 px-4",children:"Action"})]})}),e.jsx("tbody",{children:u.data.map((t,g)=>e.jsxs("tr",{className:"border-b border-[#2e3650]",children:[e.jsx("td",{className:"py-2 px-4",children:g+1}),e.jsx("td",{className:"py-2 px-4",children:D(t.name)}),e.jsx("td",{className:"py-2 px-4",children:Y(t.basePrice.toString())}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("button",{className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded font-semibold",onClick:()=>ie(t),title:"Assign Product",children:"Assign ➕"})})]},t._id))})]}):e.jsx("div",{className:"text-gray-400",children:"No available products found."})]}),E&&e.jsxs("div",{className:"text-red-400 mb-2",children:[E," ❗"]}),e.jsx("div",{className:"flex justify-end gap-2 mt-6",children:_?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"px-4 py-2 rounded bg-gray-600 hover:bg-gray-700",onClick:()=>{O(!1),C(null)},children:"Back"}),e.jsx("button",{className:"px-4 py-2 rounded bg-green-600 hover:bg-green-700 text-white",disabled:y!==null,onClick:ee,children:y?"Assigning...":"Assign Product"})]}):e.jsx("button",{className:"px-4 py-2 rounded bg-gray-600 hover:bg-gray-700",onClick:()=>{v(!1),O(!1),C(null)},children:"Close"})})]})]}),e.jsx(Ee,{open:P,mode:"edit",initialValues:T||void 0,loading:J.status==="pending",error:J.isError?J.error?.message:null,onClose:()=>{N(!1),l(null)},onSubmit:t=>{T&&J.mutate({shopProductId:T._id,data:t})}}),e.jsx(Se,{open:!!$,images:$?.images||[],initialIndex:$?.initialIndex||0,onClose:()=>U(null)})]})}const Re=[{key:"info",label:"Shop Info"},{key:"orders",label:"Shop Orders"},{key:"couriers",label:"Shop Couriers"},{key:"products",label:"Shop Products"}];function Ge(){const{shopId:s}=ue(),h=me(),[i,c]=a.useState("info"),{data:b,isLoading:p,error:k}=Z({queryKey:["shop",s],queryFn:()=>be(s),enabled:!!s}),v=()=>{if(!s)return null;switch(i){case"info":return e.jsx(ke,{shopData:b?.data,isLoading:p,error:k});case"orders":return e.jsx(Pe,{shopId:s});case"couriers":return e.jsx(Ae,{shopId:s});case"products":return e.jsx(Me,{shopId:s});default:return null}};return e.jsxs("div",{className:"p-8 min-h-screen bg-[#1a2236] text-white",children:[e.jsx("button",{className:"mb-4 text-blue-400 hover:underline",onClick:()=>h(-1),children:"← Back to Shops"}),e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Shop Details"}),e.jsx("div",{className:"flex gap-4 mb-6",children:Re.map(f=>e.jsx("button",{className:`px-4 py-2 rounded-t-lg font-semibold ${i===f.key?"bg-[#232b42] text-blue-300":"bg-[#232b42] text-gray-400"}`,onClick:()=>c(f.key),children:f.label},f.key))}),e.jsx("div",{className:"bg-[#232b42] rounded-xl p-6 min-h-[300px]",children:v()})]})}export{Ge as default};
