import{r as d,j as e,u as R,e as q,I as y}from"./index-BouADcV8.js";import{a as g,u as M}from"./index-DS6Sn0NB.js";import{u as N}from"./useMutation-Vq-BzWq0.js";import{C as E}from"./ConfirmDialog-kzTFUtgg.js";const F=async(t=1,l=10,n="")=>{const{data:i}=await g.get("/api/support-tickets",{params:{page:t,limit:l,search:n}});return i},_=async t=>{const{data:l}=await g.post("/api/support-tickets",t);return l},D=async t=>{const{_id:l,...n}=t,{data:i}=await g.put(`/api/support-tickets/${l}`,n);return i},A=async t=>{const{data:l}=await g.delete(`/api/support-tickets/${t}`);return l},L=[{value:"client",label:"Client"},{value:"courier",label:"Courier"},{value:"shop_owner",label:"Shop Owner"},{value:"operator",label:"Operator"}],Q=[{value:"low",label:"Low"},{value:"medium",label:"Medium"},{value:"high",label:"High"},{value:"urgent",label:"Urgent"}],K=[{value:"open",label:"Open"},{value:"in_progress",label:"In Progress"},{value:"waiting_for_response",label:"Waiting for Response"},{value:"resolved",label:"Resolved"},{value:"closed",label:"Closed"}],I=({open:t,onClose:l,onSubmit:n,loading:i,error:h,ticket:r})=>{const[c,m]=d.useState({title:"",userRole:"client",priority:"low",status:"open",description:""});d.useEffect(()=>{m(r?{title:r.title,userRole:r.userRole,priority:r.priority,status:r.status,description:r.description}:{title:"",userRole:"client",priority:"low",status:"open",description:""})},[r,t]);const o=a=>{m(u=>({...u,[a.target.name]:a.target.value}))},x=a=>{a.preventDefault(),n(c)};return t?e.jsxs("div",{className:"fixed inset-0 z-50 flex",children:[e.jsx("div",{className:"flex-1 backdrop-blur-sm bg-black/30",onClick:l}),e.jsxs("div",{className:"w-[400px] bg-[#232b42] p-8 h-full shadow-xl overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:r?"Edit Ticket":"Add Ticket"}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Title"}),e.jsx("input",{name:"title",value:c.title,onChange:o,className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white focus:outline-none",required:!0,disabled:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"User Role"}),e.jsx("select",{name:"userRole",value:c.userRole,onChange:o,className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white focus:outline-none",required:!0,disabled:i,children:L.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Priority"}),e.jsx("select",{name:"priority",value:c.priority,onChange:o,className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white focus:outline-none",required:!0,disabled:i,children:Q.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Status"}),e.jsx("select",{name:"status",value:c.status,onChange:o,className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white focus:outline-none",required:!0,disabled:i,children:K.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Description"}),e.jsx("textarea",{name:"description",value:c.description,onChange:o,className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white focus:outline-none",rows:4,required:!0,disabled:i})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-8",children:[e.jsx("button",{type:"button",className:"px-4 py-2 rounded bg-gray-600 hover:bg-gray-700",onClick:l,disabled:i,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-blue-500 hover:bg-blue-600 text-white",disabled:i,children:i?"Saving...":"Save"})]}),h&&e.jsx("div",{className:"text-red-400 mt-4",children:h})]})]})]}):null},H=()=>{const{t}=R(),[l,n]=d.useState(1),[i,h]=d.useState(10),[r,c]=d.useState(""),[m,o]=d.useState(!1),[x,a]=d.useState(null),[u,v]=d.useState(null),f=q(),{data:p,isLoading:w,isError:T}=M({queryKey:["support-tickets",l,i,r],queryFn:()=>F(l,i,r)}),b=N({mutationFn:async s=>_(s),onSuccess:()=>{o(!1),f.invalidateQueries({queryKey:["support-tickets"]})}}),j=N({mutationFn:async s=>D(s),onSuccess:()=>{o(!1),a(null),f.invalidateQueries({queryKey:["support-tickets"]})}}),k=N({mutationFn:async s=>A(s._id),onSuccess:()=>{v(null),f.invalidateQueries({queryKey:["support-tickets"]})}}),C=()=>{a(null),o(!0)},S=s=>{a(s),o(!0)},P=s=>{v(s)};return e.jsxs("div",{className:"p-8 min-h-screen bg-[#1a2236] text-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:t("navigation.supportTickets")}),e.jsxs("button",{className:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold",onClick:C,children:[e.jsx(y,{icon:"mdi:plus",className:"inline-block mr-2"})," ",t("supportTickets.addTicket")]})]}),e.jsxs("div",{className:"mb-4 flex items-center",children:[e.jsx("input",{className:"bg-[#232b42] text-white px-4 py-2 rounded-lg w-80 focus:outline-none focus:ring",placeholder:t("supportTickets.searchTicket"),value:r,onChange:s=>{c(s.target.value),n(1)}}),e.jsxs("span",{className:"ml-4 text-gray-400",children:[t("navigation.dashboard")," â€¢ ",e.jsx("span",{className:"bg-blue-900 text-blue-300 px-2 py-1 rounded text-xs ml-2",children:t("navigation.supportTickets")})]})]}),e.jsx("div",{className:"bg-[#232b42] rounded-xl overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-[#2e3650]",children:[e.jsx("th",{className:"py-3 px-4",children:"#"}),e.jsx("th",{className:"py-3 px-4",children:t("supportTickets.title")}),e.jsx("th",{className:"py-3 px-4",children:t("supportTickets.userRole")}),e.jsx("th",{className:"py-3 px-4",children:t("supportTickets.priority")}),e.jsx("th",{className:"py-3 px-4",children:t("supportTickets.status")}),e.jsx("th",{className:"py-3 px-4",children:t("supportTickets.createdAt")}),e.jsx("th",{className:"py-3 px-4 text-center",children:t("supportTickets.actions")})]})}),e.jsx("tbody",{children:w?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-8",children:t("common.loading")})}):T?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-8 text-red-400",children:t("supportTickets.failedToLoad")})}):p?.data?.length?p?.data?.map(s=>e.jsxs("tr",{className:"border-b border-[#2e3650] hover:bg-[#202840] transition",children:[e.jsx("td",{className:"py-3 px-4",children:s.ticketNumber}),e.jsx("td",{className:"py-3 px-4",children:s.title}),e.jsx("td",{className:"py-3 px-4",children:s.userRole}),e.jsx("td",{className:"py-3 px-4",children:s.priority}),e.jsx("td",{className:"py-3 px-4",children:s.status}),e.jsx("td",{className:"py-3 px-4",children:new Date(s.createdAt).toLocaleString()}),e.jsxs("td",{className:"py-3 px-4 text-center flex gap-3 justify-center",children:[e.jsx("button",{className:"hover:text-blue-400",title:t("common.edit"),onClick:()=>S(s),children:e.jsx(y,{icon:"mdi:pencil",width:18,height:18})}),e.jsx("button",{className:"hover:text-red-400",title:t("common.delete"),onClick:()=>P(s),children:e.jsx(y,{icon:"mdi:delete",width:18,height:18})})]})]},s._id)):e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-16 text-gray-400",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(y,{icon:"mdi:lifebuoy",className:"text-5xl mb-4"}),e.jsx("div",{className:"text-lg font-medium",children:t("supportTickets.noTicketsFound")}),e.jsx("div",{className:"text-sm",children:t("supportTickets.clickAddTicketToCreate")})]})})})})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:[t("common.itemsPerPage"),":"]}),e.jsx("select",{className:"bg-[#232b42] text-white px-2 py-1 rounded",value:i,onChange:s=>{h(Number(s.target.value)),n(1)},children:[5,10,20,50].map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("button",{className:"px-2 py-1 mx-1 rounded disabled:opacity-50",onClick:()=>n(1),disabled:l===1,children:t("common.pagination.first")}),e.jsx("button",{className:"px-2 py-1 mx-1 rounded disabled:opacity-50",onClick:()=>n(s=>Math.max(1,s-1)),disabled:l===1,children:t("common.pagination.previous")}),e.jsxs("span",{className:"mx-2",children:[l," / ",p?.meta?.totalPages??1]}),e.jsx("button",{className:"px-2 py-1 mx-1 rounded disabled:opacity-50",onClick:()=>n(s=>Math.min(p?.meta?.totalPages??1,s+1)),disabled:l===(p?.meta?.totalPages??1),children:t("common.pagination.next")}),e.jsx("button",{className:"px-2 py-1 mx-1 rounded disabled:opacity-50",onClick:()=>n(p?.meta?.totalPages??1),disabled:l===(p?.meta?.totalPages??1),children:t("common.pagination.last")})]})]}),e.jsx(I,{open:m,ticket:x||void 0,loading:b.isPending||j.isPending,error:b.isError?b.error?.message:j.isError?j.error?.message:null,onClose:()=>{o(!1),a(null)},onSubmit:s=>{x?j.mutate({...x,...s}):b.mutate(s)}}),e.jsx(E,{open:!!u,title:t("supportTickets.deleteTicket"),description:u?t("supportTickets.deleteTicketConfirmation",{ticketNumber:u.ticketNumber}):"",loading:k.isPending,onCancel:()=>v(null),onConfirm:()=>{u&&k.mutate(u)}})]})};export{H as default};
