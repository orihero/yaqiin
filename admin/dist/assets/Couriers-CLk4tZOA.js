import{r as o,R as T,j as e,u as K,e as Q,y as g}from"./index-BouADcV8.js";import{u as P}from"./index-DS6Sn0NB.js";import{u as E}from"./useMutation-Vq-BzWq0.js";import{u as R}from"./index.esm-A7arJavU.js";import{f as M,e as B}from"./userService-CG63Svn2.js";import{d as H,A as z}from"./react-select-async.esm-DrB-_ZcM.js";import{a as S}from"./api-DwbFXHRK.js";import{C as W}from"./ConfirmDialog-kzTFUtgg.js";import"./index-Bb9g-u9F.js";function G({open:s,mode:i,initialValues:a,loading:n,error:j,details:c,onClose:N,onSubmit:k}){const p=i==="edit",m=i==="add",{register:x,handleSubmit:v,reset:y,formState:{errors:u},setValue:h}=R({defaultValues:{vehicleType:"",licenseNumber:"",availability:"available",...a,isActive:String(a?.isActive)==="false"?"false":"true"}}),[I,A]=o.useState(!1),[b,f]=o.useState(!1),[q,r]=o.useState(!1),[F,V]=o.useState(""),[L,D]=o.useState(a?.userId?{value:a.userId,label:a.userId}:null),O=T.useMemo(()=>H((t,d)=>{M().then(U=>{const _=(U||[]).filter(l=>{if(!t)return!0;const w=t.toLowerCase();return l.firstName&&l.firstName.toLowerCase().includes(w)||l.lastName&&l.lastName.toLowerCase().includes(w)||l.username&&l.username.toLowerCase().includes(w)||l.phoneNumber&&l.phoneNumber.includes(w)});d(_.map(l=>({value:l._id,label:`${l.firstName} ${l.lastName} (${l.username})`})))})},300),[]),$={control:(t,d)=>({...t,backgroundColor:"#1a2236",color:"white",borderColor:d.isFocused?"#2563eb":"#232b42",boxShadow:d.isFocused?"0 0 0 1px #2563eb":"none",minHeight:"40px"}),menu:t=>({...t,backgroundColor:"#232b42",color:"white"}),option:(t,d)=>({...t,backgroundColor:d.isSelected?"#2563eb":d.isFocused?"#232b42":"#1a2236",color:"white",cursor:"pointer"}),singleValue:t=>({...t,color:"white"}),input:t=>({...t,color:"white"}),placeholder:t=>({...t,color:"#a3a3a3"}),dropdownIndicator:t=>({...t,color:"#a3a3a3"}),indicatorSeparator:t=>({...t,backgroundColor:"#232b42"})},{data:C,isLoading:ee,error:se}=P({queryKey:[m?"available-couriers":"all-couriers"],queryFn:m?M:B,enabled:s});return T.useMemo(()=>C?m?C:C.filter(t=>t.role==="courier"):[],[C,m]),o.useEffect(()=>{s&&y({vehicleType:a?.vehicleType||"",licenseNumber:a?.licenseNumber||"",availability:a?.availability||"available",userId:a?.userId||"",isActive:String(a?.isActive)==="false"?"false":"true"})},[s,a,y]),s?e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm transition-all",style:{backdropFilter:"blur(8px)"},onClick:N}),e.jsxs("div",{className:"fixed top-0 right-0 h-full w-full max-w-xl bg-[#232b42] shadow-2xl p-8 overflow-y-auto transition-transform duration-300 transform translate-x-0",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:p?"Edit Courier":"Add Courier"}),j&&e.jsx("div",{className:"text-red-400 mb-2",children:j}),e.jsxs("form",{onSubmit:v(t=>{let d={...t,isActive:t.isActive==="true",userId:L?.value};k(d)}),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block mb-1",children:"Vehicle Type"}),e.jsx("input",{className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white",...x("vehicleType",{required:"Vehicle type is required"})}),u.vehicleType&&e.jsx("span",{className:"text-red-400 text-xs",children:u.vehicleType.message})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block mb-1",children:"License Number"}),e.jsx("input",{className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white",...x("licenseNumber",{required:"License number is required"})}),u.licenseNumber&&e.jsx("span",{className:"text-red-400 text-xs",children:u.licenseNumber.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Availability"}),e.jsxs("select",{className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white",...x("availability",{required:!0}),children:[e.jsx("option",{value:"available",children:"Available"}),e.jsx("option",{value:"busy",children:"Busy"}),e.jsx("option",{value:"offline",children:"Offline"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Status"}),e.jsxs("select",{className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white",...x("isActive",{required:!0}),children:[e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"User"}),e.jsx(z,{classNamePrefix:"react-select",className:"w-full",styles:$,isClearable:!0,isSearchable:!0,placeholder:"Select courier user",cacheOptions:!0,defaultOptions:!0,loadOptions:O,value:L,onChange:t=>D(t),required:!0}),u.userId&&e.jsx("span",{className:"text-red-400 text-xs",children:u.userId.message})]})]}),c&&(typeof c=="string"?e.jsx("div",{className:"text-red-400 text-xs mt-2",children:c}):c.errors?e.jsx("ul",{className:"text-red-400 text-xs mb-2",children:Object.entries(c.errors).map(([t,d])=>e.jsxs("li",{children:[t,": ",d.message]},t))}):c.message?e.jsx("div",{className:"text-red-400 text-xs mb-2",children:c.message}):null),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx("button",{type:"button",className:"px-4 py-2 rounded bg-gray-600 hover:bg-gray-700",onClick:N,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded bg-blue-500 hover:bg-blue-600",disabled:n,children:n?p?"Saving...":"Creating...":"Save"})]})]})]})]}):null}async function J(s=1,i=5,a=""){const n=new URLSearchParams({page:String(s),limit:String(i)});return a&&n.append("search",a),(await S.get(`/couriers?${n.toString()}`)).data}async function X(s){return(await S.post("/couriers",s)).data}async function Y(s){const{_id:i,...a}=s;return(await S.put(`/couriers/${i}`,a)).data}async function Z(s){return(await S.delete(`/couriers/${s}`)).data}function ue(){const{t:s}=K(),[i,a]=o.useState(1),[n,j]=o.useState(5),[c,N]=o.useState(""),[k,p]=o.useState(!1),[m,x]=o.useState(null),[v,y]=o.useState(null),u=Q(),{data:h,isLoading:I,error:A}=P({queryKey:["couriers",i,n,c],queryFn:()=>J(i,n,c)}),b=E({mutationFn:async r=>X(r),onSuccess:()=>{p(!1),u.invalidateQueries({queryKey:["couriers"]}),g.success(s("couriers.createdSuccessfully"))},onError:r=>{g.error(r?.message||s("couriers.failedToCreate"))}}),f=E({mutationFn:async r=>Y(r),onSuccess:()=>{p(!1),x(null),u.invalidateQueries({queryKey:["couriers"]}),g.success(s("couriers.updatedSuccessfully"))},onError:r=>{g.error(r?.message||s("couriers.failedToUpdate"))}}),q=E({mutationFn:async r=>{if(!r||!r._id)throw new Error("Invalid courier");return Z(r._id)},onSuccess:()=>{y(null),u.invalidateQueries({queryKey:["couriers"]}),g.success(s("couriers.deletedSuccessfully"))},onError:r=>{g.error(r?.message||s("couriers.failedToDelete"))}});return e.jsxs("div",{className:"p-8 min-h-screen bg-[#1a2236] text-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:s("navigation.couriers")}),e.jsx("button",{className:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold",onClick:()=>{x(null),p(!0)},children:s("couriers.addCourier")})]}),e.jsx("div",{className:"mb-4 flex items-center",children:e.jsx("input",{className:"bg-[#232b42] text-white px-4 py-2 rounded-lg w-80 focus:outline-none focus:ring",placeholder:s("couriers.searchCourier"),value:c,onChange:r=>N(r.target.value)})}),e.jsx("div",{className:"bg-[#232b42] rounded-xl overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-[#2e3650]",children:[e.jsx("th",{className:"py-3 px-4",children:"#"}),e.jsx("th",{className:"py-3 px-4",children:s("couriers.vehicle")}),e.jsx("th",{className:"py-3 px-4",children:s("couriers.license")}),e.jsx("th",{className:"py-3 px-4",children:s("couriers.availability")}),e.jsx("th",{className:"py-3 px-4",children:s("couriers.status")}),e.jsx("th",{className:"py-3 px-4",children:s("couriers.created")}),e.jsx("th",{className:"py-3 px-4",children:s("couriers.action")})]})}),e.jsx("tbody",{children:I?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-8",children:s("common.loading")})}):A?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-8 text-red-400",children:String(A.message)})}):h?.data?.length?h.data.map((r,F)=>e.jsxs("tr",{className:"border-b border-[#2e3650] hover:bg-[#202840] transition",children:[e.jsx("td",{className:"py-3 px-4",children:(i-1)*n+F+1}),e.jsx("td",{className:"py-3 px-4",children:r.vehicleType}),e.jsx("td",{className:"py-3 px-4",children:r.licenseNumber}),e.jsx("td",{className:"py-3 px-4 capitalize",children:r.availability}),e.jsx("td",{className:"py-3 px-4",children:r.isActive?s("common.active"):s("common.inactive")}),e.jsx("td",{className:"py-3 px-4",children:new Date(r.createdAt).toLocaleDateString()}),e.jsxs("td",{className:"py-3 px-4 flex gap-3",children:[e.jsx("button",{onClick:()=>{x(r),p(!0)},className:"hover:text-blue-400",title:s("common.edit"),children:s("common.edit")}),e.jsx("button",{onClick:()=>y(r),className:"hover:text-red-400",title:s("common.delete"),children:s("common.delete")})]})]},r._id)):e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-8",children:s("couriers.noCouriersFound")})})})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:[s("common.itemsPerPage"),":"]}),e.jsx("select",{className:"bg-[#232b42] text-white px-2 py-1 rounded",value:n,onChange:r=>{j(Number(r.target.value)),a(1)},children:[5,10,20,50].map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{children:[e.jsx("button",{className:"px-2 py-1 mx-1 rounded disabled:opacity-50",onClick:()=>a(1),disabled:i===1,children:s("common.pagination.first")}),e.jsx("button",{className:"px-2 py-1 mx-1 rounded disabled:opacity-50",onClick:()=>a(r=>Math.max(1,r-1)),disabled:i===1,children:s("common.pagination.previous")}),e.jsxs("span",{className:"mx-2",children:[i," / ",h?.meta?.totalPages??1]}),e.jsx("button",{className:"px-2 py-1 mx-1 rounded disabled:opacity-50",onClick:()=>a(r=>Math.min(h?.meta?.totalPages??1,r+1)),disabled:i===(h?.meta?.totalPages??1),children:s("common.pagination.next")}),e.jsx("button",{className:"px-2 py-1 mx-1 rounded disabled:opacity-50",onClick:()=>a(h?.meta?.totalPages??1),disabled:i===(h?.meta?.totalPages??1),children:s("common.pagination.last")})]})]}),e.jsx(G,{open:k,mode:m?"edit":"add",initialValues:m||void 0,loading:b.status==="pending"||f.status==="pending",error:b.isError?b.error?.message:f.isError?f.error?.message:null,details:b.isError?b.error?.details:f.isError?f.error?.details:null,onClose:()=>{p(!1),x(null)},onSubmit:r=>{m?f.mutate({...r,_id:m._id}):b.mutate(r)}}),e.jsx(W,{open:!!v,title:s("couriers.deleteCourier"),description:s("couriers.deleteCourierConfirmation"),loading:q.status==="pending",onCancel:()=>y(null),onConfirm:()=>v&&q.mutate(v)})]})}export{ue as default};
