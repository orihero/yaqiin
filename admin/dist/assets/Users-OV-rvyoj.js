import{u as q,R as U,j as e,r as u,e as D}from"./index-BouADcV8.js";import{u as M}from"./index-DS6Sn0NB.js";import{u as v}from"./useMutation-Vq-BzWq0.js";import{u as E}from"./index.esm-A7arJavU.js";import{C as P}from"./ConfirmDialog-kzTFUtgg.js";import{c as F,u as _,d as L,g as Q}from"./userService-CG63Svn2.js";import"./api-DwbFXHRK.js";function K(t){return t?typeof t=="string"?e.jsx("div",{className:"text-red-400 text-xs",children:t}):t.errors?e.jsx("ul",{className:"text-red-400 text-xs mb-2",children:Object.entries(t.errors).map(([n,d])=>e.jsxs("li",{children:[n,": ",d.message]},n))}):t.message?e.jsx("div",{className:"text-red-400 text-xs mb-2",children:t.message}):null:null}function k({open:t,mode:n,initialValues:d,loading:o,error:N,details:b,onClose:g,onSubmit:j}){const{t:a}=q(),i=n==="edit",{register:l,handleSubmit:c,reset:x,formState:{errors:r}}=E({defaultValues:{telegramId:"",firstName:"",lastName:"",username:"",email:"",phoneNumber:"",role:"client",status:"active",...d}});return U.useEffect(()=>{t&&x({telegramId:"",firstName:"",lastName:"",username:"",email:"",phoneNumber:"",role:"client",status:"active",...d})},[t,d,x]),t?e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm transition-all",style:{backdropFilter:"blur(8px)"},onClick:g}),e.jsxs("div",{className:"fixed top-0 right-0 h-full w-full max-w-xl bg-[#232b42] shadow-2xl p-8 overflow-y-auto transition-transform duration-300 transform translate-x-0",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:i?`✏️ ${a("users.editUser")}`:`➕ ${a("users.addUser")}`}),N&&e.jsxs("div",{className:"text-red-400 mb-2",children:["❌ ",N]}),K(b),e.jsxs("form",{onSubmit:c(f=>j(f)),children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"📱 Telegram ID"}),e.jsx("input",{className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white",...l("telegramId",{required:a("forms.validation.required")})}),r.telegramId&&e.jsx("span",{className:"text-red-400 text-xs",children:r.telegramId.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-1",children:["👤 ",a("users.firstName")]}),e.jsx("input",{className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white",...l("firstName",{required:a("forms.validation.required")})}),r.firstName&&e.jsx("span",{className:"text-red-400 text-xs",children:r.firstName.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-1",children:["👤 ",a("users.lastName")]}),e.jsx("input",{className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white",...l("lastName",{required:a("forms.validation.required")})}),r.lastName&&e.jsx("span",{className:"text-red-400 text-xs",children:r.lastName.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-1",children:["👤 ",a("users.username")]}),e.jsx("input",{className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white",...l("username",{required:a("forms.validation.required")})}),r.username&&e.jsx("span",{className:"text-red-400 text-xs",children:r.username.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-1",children:["📧 ",a("users.email")]}),e.jsx("input",{className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white",type:"email",...l("email",{required:a("forms.validation.required")})}),r.email&&e.jsx("span",{className:"text-red-400 text-xs",children:r.email.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-1",children:["📱 ",a("users.phoneNumber")]}),e.jsx("input",{className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white",...l("phoneNumber",{required:a("forms.validation.required")})}),r.phoneNumber&&e.jsx("span",{className:"text-red-400 text-xs",children:r.phoneNumber.message})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-1",children:["🎭 ",a("users.role")]}),e.jsxs("select",{className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white",...l("role",{required:!0}),children:[e.jsx("option",{value:"client",children:a("users.roles.client","Client")}),e.jsx("option",{value:"courier",children:a("users.roles.courier","Courier")}),e.jsx("option",{value:"admin",children:a("users.roles.admin","Admin")}),e.jsx("option",{value:"shop_owner",children:a("users.roles.shopOwner","Shop Owner")}),e.jsx("option",{value:"operator",children:a("users.roles.operator","Operator")})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-1",children:["📊 ",a("common.status")]}),e.jsxs("select",{className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white",...l("status",{required:!0}),children:[e.jsx("option",{value:"active",children:a("common.active")}),e.jsx("option",{value:"inactive",children:a("common.inactive")}),e.jsx("option",{value:"suspended",children:a("users.statuses.suspended","Suspended")})]})]}),!i&&e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-1",children:["🔒 ",a("users.password")]}),e.jsx("input",{className:"w-full px-3 py-2 rounded bg-[#1a2236] text-white",type:"password",...l("password",{required:i?!1:a("forms.validation.required"),minLength:{value:6,message:a("forms.validation.minLength",{min:6})}})}),r.password&&e.jsx("span",{className:"text-red-400 text-xs",children:r.password.message})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsxs("button",{type:"button",className:"px-4 py-2 rounded bg-gray-600 hover:bg-gray-700 flex items-center gap-2",onClick:g,children:[e.jsx("span",{children:"❌"}),a("common.cancel")]}),e.jsxs("button",{type:"submit",className:"px-4 py-2 rounded bg-blue-500 hover:bg-blue-600 flex items-center gap-2",disabled:o,children:[e.jsx("span",{children:o?"🔄":"💾"}),o?i?a("users.saving","Saving..."):a("users.creating","Creating..."):a("common.save")]})]})]})]})]}):null}function W(){const{t}=q(),[n,d]=u.useState(1),[o,N]=u.useState(5),[b,g]=u.useState(""),[j,a]=u.useState(!1),[i,l]=u.useState(null),[c,x]=u.useState(null),[r,f]=u.useState(null),y=D(),{data:m,isLoading:I,error:w}=M({queryKey:["users",n,o,b],queryFn:()=>Q(n,o,b)}),p=v({mutationFn:async s=>F(s),onSuccess:()=>{a(!1),y.invalidateQueries({queryKey:["users"]})}}),h=v({mutationFn:async s=>_(s),onSuccess:()=>{a(!1),l(null),y.invalidateQueries({queryKey:["users"]})}}),S=v({mutationFn:async s=>{if(!s||!s._id)throw new Error("Invalid user");return L(s._id)},onSuccess:()=>{x(null),y.invalidateQueries({queryKey:["users"]})}}),{register:O,handleSubmit:T,reset:C,formState:{errors:z}}=E({defaultValues:{firstName:"",lastName:"",username:"",email:"",phoneNumber:"",role:"client",status:"active",password:""}});return U.useEffect(()=>{j&&!i&&C()},[j,i,C]),e.jsxs("div",{className:"p-8 min-h-screen bg-[#1a2236] text-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold",children:["👥 ",t("users.title")]}),e.jsxs("button",{className:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold flex items-center gap-2",onClick:()=>{l(null),a(!0)},children:[e.jsx("span",{children:"➕"}),t("users.addUser")]})]}),e.jsxs("div",{className:"mb-4 flex items-center",children:[e.jsx("input",{className:"bg-[#232b42] text-white px-4 py-2 rounded-lg w-80 focus:outline-none focus:ring",placeholder:`🔍 ${t("common.search")} ${t("users.title").toLowerCase()}`,value:b,onChange:s=>g(s.target.value)}),e.jsxs("span",{className:"ml-4 text-gray-400",children:["📊 ",t("navigation.dashboard")," • ",e.jsxs("span",{className:"bg-blue-900 text-blue-300 px-2 py-1 rounded text-xs ml-2",children:["👥 ",t("users.title")]})]})]}),e.jsx("div",{className:"bg-[#232b42] rounded-xl overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-[#2e3650]",children:[e.jsx("th",{className:"py-3 px-4",children:"#"}),e.jsxs("th",{className:"py-3 px-4",children:["👤 ",t("users.name","Name")]}),e.jsxs("th",{className:"py-3 px-4",children:["📧 ",t("users.email")]}),e.jsxs("th",{className:"py-3 px-4",children:["📱 ",t("users.phoneNumber")]}),e.jsxs("th",{className:"py-3 px-4",children:["📅 ",t("users.registrationDate")]}),e.jsxs("th",{className:"py-3 px-4",children:["🎭 ",t("users.role")]}),e.jsxs("th",{className:"py-3 px-4",children:["📊 ",t("common.status")]}),e.jsxs("th",{className:"py-3 px-4",children:["⚙️ ",t("common.actions")]})]})}),e.jsx("tbody",{children:I?e.jsx("tr",{children:e.jsxs("td",{colSpan:8,className:"text-center py-8",children:["🔄 ",t("common.loading")]})}):w?e.jsx("tr",{children:e.jsxs("td",{colSpan:8,className:"text-center py-8 text-red-400",children:["❌ ",String(w.message)]})}):m?.data?.length?m.data.map((s,$)=>e.jsxs("tr",{className:"border-b border-[#2e3650] hover:bg-[#202840] transition",children:[e.jsx("td",{className:"py-3 px-4",children:(n-1)*o+$+1}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center text-lg font-bold",children:s.firstName?.[0]||s.username?.[0]||"?"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold",children:[s.firstName," ",s.lastName]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["@",s.username]})]})]})}),e.jsx("td",{className:"py-3 px-4",children:s.email}),e.jsx("td",{className:"py-3 px-4",children:s.phoneNumber}),e.jsx("td",{className:"py-3 px-4",children:new Date(s.createdAt).toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),e.jsx("td",{className:"py-3 px-4 capitalize",children:t(`users.roles.${s.role}`,s.role)}),e.jsx("td",{className:"py-3 px-4 capitalize",children:t(`common.${s.status}`,s.status)}),e.jsxs("td",{className:"py-3 px-4 flex gap-3",children:[e.jsx("button",{onClick:()=>{l(s),a(!0)},className:"hover:text-blue-400",title:t("common.edit"),children:"✏️"}),e.jsx("button",{onClick:()=>x(s),className:"hover:text-red-400",title:t("common.delete"),children:"🗑️"}),e.jsx("button",{className:"hover:text-green-400",title:t("users.copyUserId","Copy User ID"),onClick:async()=>{await navigator.clipboard.writeText(s._id),f(s._id),setTimeout(()=>f(null),1500)},children:"📋"}),r===s._id&&e.jsxs("span",{className:"ml-2 text-green-400 text-xs",children:["✅ ",t("users.copied","Copied!")]})]})]},s._id)):e.jsx("tr",{children:e.jsxs("td",{colSpan:8,className:"text-center py-8",children:["📭 ",t("users.noUsersFound","No users found.")]})})})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["📄 ",t("common.itemsPerPage"),":"]}),e.jsx("select",{className:"bg-[#232b42] text-white px-2 py-1 rounded",value:o,onChange:s=>{N(Number(s.target.value)),d(1)},children:[5,10,20,50].map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("button",{className:"px-2 py-1 mx-1 rounded disabled:opacity-50",onClick:()=>d(1),disabled:n===1,children:t("common.pagination.first")}),e.jsx("button",{className:"px-2 py-1 mx-1 rounded disabled:opacity-50",onClick:()=>d(s=>Math.max(1,s-1)),disabled:n===1,children:t("common.pagination.previous")}),e.jsxs("span",{className:"mx-2",children:[n," / ",m?.meta?.totalPages??1]}),e.jsx("button",{className:"px-2 py-1 mx-1 rounded disabled:opacity-50",onClick:()=>d(s=>Math.min(m?.meta?.totalPages??1,s+1)),disabled:n===(m?.meta?.totalPages??1),children:t("common.pagination.next")}),e.jsx("button",{className:"px-2 py-1 mx-1 rounded disabled:opacity-50",onClick:()=>d(m?.meta?.totalPages??1),disabled:n===(m?.meta?.totalPages??1),children:t("common.pagination.last")})]})]}),e.jsx(k,{open:j&&!i,mode:"add",loading:p.status==="pending",error:p.isError?p.error?.message:null,details:p.isError?p.error?.details:null,onClose:()=>a(!1),onSubmit:s=>p.mutate({...s,password:s.password??""})}),e.jsx(k,{open:!!i,mode:"edit",initialValues:i||void 0,loading:h.status==="pending",error:h.isError?h.error?.message:null,details:h.isError?h.error?.details:null,onClose:()=>l(null),onSubmit:s=>{i&&h.mutate({...i,...s})}}),e.jsx(P,{open:!!c,title:`🗑️ ${t("users.deleteUser")}`,description:c?`${t("modals.confirmDelete")} ${c.firstName} ${c.lastName}?`:"",loading:S.status==="pending",onCancel:()=>x(null),onConfirm:()=>{c&&S.mutate(c)}})]})}export{W as default};
